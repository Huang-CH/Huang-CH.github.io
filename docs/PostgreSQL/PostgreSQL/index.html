<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="简介# PostgreSQL简称PG或PGSQL，是使用C和C&#43;&#43;语言开发的，开源的，关系型数据库，支持多种操作系统平台，是一种比较好的Oracle数据库替代方案。
 官方网站：https://www.postgresql.org
中文社区：http://www.postgres.cn
  安装# Yum Repository#  PostgreSQL: Linux downloads (Red Hat family)
 # Install the repository RPM: sudo dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm # Disable the built-in PostgreSQL module: sudo dnf -qy module disable postgresql # Install PostgreSQL: sudo dnf install -y postgresql14-server # Optionally initialize the database and enable automatic start: sudo /usr/pgsql-14/bin/postgresql-14-setup initdb sudo systemctl enable postgresql-14 sudo systemctl start postgresql-14  Apt Repository#  PostgreSQL: Linux downloads (Debian)">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="PostgreSQL" />
<meta property="og:description" content="简介# PostgreSQL简称PG或PGSQL，是使用C和C&#43;&#43;语言开发的，开源的，关系型数据库，支持多种操作系统平台，是一种比较好的Oracle数据库替代方案。
 官方网站：https://www.postgresql.org
中文社区：http://www.postgres.cn
  安装# Yum Repository#  PostgreSQL: Linux downloads (Red Hat family)
 # Install the repository RPM: sudo dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm # Disable the built-in PostgreSQL module: sudo dnf -qy module disable postgresql # Install PostgreSQL: sudo dnf install -y postgresql14-server # Optionally initialize the database and enable automatic start: sudo /usr/pgsql-14/bin/postgresql-14-setup initdb sudo systemctl enable postgresql-14 sudo systemctl start postgresql-14  Apt Repository#  PostgreSQL: Linux downloads (Debian)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Huang-CH.github.io/docs/PostgreSQL/PostgreSQL/" /><meta property="article:section" content="docs" />



<title>PostgreSQL | 黄 超 | H&amp;C</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.95d69eb6bad8b9707ff2b5d8d9e31ce70a1b84f2ed7ffaf665ffcf00aa7993bd.css" integrity="sha256-ldaetrrYuXB/8rXY2eMc5wobhPLtf/r2Zf/PAKp5k70=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.c2873a96ee9cb19e117f2ad1c37cd6adb69661de9c19b3aaaea1c0dfa469b4ee.js" integrity="sha256-woc6lu6csZ4RfyrRw3zWrbaWYd6cGbOqrqHA36RptO4=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>黄 超 | H&amp;C</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3ca9a5c09bd1884bf69ade02a8e53628" class="toggle"  />
    <label for="section-3ca9a5c09bd1884bf69ade02a8e53628" class="flex justify-between">
      <a role="button" class="">Linux</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-30329090b70c299db66b1665fc9cdf79" class="toggle"  />
    <label for="section-30329090b70c299db66b1665fc9cdf79" class="flex justify-between">
      <a role="button" class="">Linux运维基础</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Keepalived/" class="">Keepalived</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/LVS/" class="">LVS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Nginx/" class="">Nginx</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/NFS/" class="">NFS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Rsync/" class="">Rsync</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Ansible/" class="">Ansible</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Supervisor/" class="">Spuervisor</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Linux%E7%9A%84systemd/" class="">Linux的systemd</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Firewalld%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80/" class="">Firewalld防火墙基础</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Linux%E7%A3%81%E7%9B%98%E7%9A%84%E6%93%8D%E4%BD%9C/" class="">Linux磁盘的操作</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/NetworkManager/" class="">NetworkManager</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/%E5%80%9F%E5%8A%A9%E7%B3%BB%E7%BB%9F%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86%E5%99%A8%E7%AE%A1%E7%90%86LVM/" class="">借助系统存储管理器管理LVM</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Linux%E5%AE%9E%E7%8E%B0SSH%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86/" class="">Linux实现SSH免密登录</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Linux%E5%A4%9A%E7%BD%91%E5%8D%A1%E7%BB%91%E5%AE%9ABond/" class="">Linux多网卡绑定Bond</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Linux%E5%88%A0%E9%99%A4%E6%97%A7%E7%89%88%E6%9C%AC%E5%86%85%E6%A0%B8/" class="">Linux删除旧版本内核</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Linux%E5%AE%9E%E7%8E%B0history%E5%91%BD%E4%BB%A4%E6%B7%BB%E5%8A%A0%E6%97%B6%E9%97%B4%E5%92%8CIP/" class="">Linux实现history命令添加时间和IP</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/Linux%E7%9A%84LVM%E6%89%A9%E5%AE%B9/" class="">Linux的LVM扩容</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Basic-Operation/%E8%A7%A3%E5%86%B3OpenMediaVault%E4%B8%ADFTP%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/" class="">解决OpenMediaVault中FTP乱码问题</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b8ab17e00886c44c945c0ebf9036be5e" class="toggle"  />
    <label for="section-b8ab17e00886c44c945c0ebf9036be5e" class="flex justify-between">
      <a role="button" class="">CentOS</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/CentOS/CentOS-7%E5%80%9F%E5%8A%A9%E7%B3%BB%E7%BB%9F%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86%E5%99%A8%E7%AE%A1%E7%90%86LVM/" class="">CentOS 7借助系统存储管理器管理LVM</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/CentOS/CentOS-7%E6%90%AD%E5%BB%BAFTP%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="">CentOS 7搭建FTP服务器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/CentOS/CentOS-7%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="">CentOS 7搭建Git服务器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/CentOS/CentOS-7%E6%90%AD%E5%BB%BASamba%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="">CentOS 7搭建Samba服务器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/CentOS/CentOS-7%E6%90%AD%E5%BB%BA%E7%A6%BB%E7%BA%BFYum%E6%BA%90/" class="">CentOS 7搭建离线YUM源服务器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/CentOS/CentOS-7%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E5%85%89%E7%9B%98%E6%BA%90/" class="">CentOS 7配置本地光盘源</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/CentOS/CentOS-7%E9%9D%99%E9%BB%98%E5%AE%89%E8%A3%85Oracle-19c/" class="">CentOS 7静默安装Oracle 19c</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-35013df187ba109d617f6614b484064f" class="toggle"  />
    <label for="section-35013df187ba109d617f6614b484064f" class="flex justify-between">
      <a role="button" class="">Debian</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Debian/Debian%E6%90%AD%E5%BB%BAAPT%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="">Debian搭建APT服务器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/Debian/Debian%E7%B3%BB%E7%BB%9F%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/" class="">Debian系统常用配置</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b952f606fcdbfce72c278f9ff9bb4911" class="toggle"  />
    <label for="section-b952f606fcdbfce72c278f9ff9bb4911" class="flex justify-between">
      <a role="button" class="">OpenEuler</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Linux/OpenEuler/OpenEuler%E6%90%AD%E5%BB%BAGlusterFS%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" class="">OpenEuler搭建GlusterFS分布式存储</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-25bdf6accfe3785fbb4a2e3f647c2ece" class="toggle"  />
    <label for="section-25bdf6accfe3785fbb4a2e3f647c2ece" class="flex justify-between">
      <a role="button" class="">Shell</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Shell/Shell-Script/" class="">Shell Script</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Shell/CentOS-7%E5%8D%87%E7%BA%A7SSH%E8%84%9A%E6%9C%AC/" class="">CentOS 7升级SSH脚本</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8ca541663a7d7fd63c79c6ce40ab5b81" class="toggle"  />
    <label for="section-8ca541663a7d7fd63c79c6ce40ab5b81" class="flex justify-between">
      <a role="button" class="">Python</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="">Python之基础数据类型</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" class="">Python之字符编码</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/" class="">Python之文件操作</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4%E4%B8%8E%E4%BD%9C%E7%94%A8%E5%9F%9F/" class="">Python之名称空间与作用域</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E5%87%BD%E6%95%B0/" class="">Python之函数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E8%BF%AD%E4%BB%A3%E5%99%A8/" class="">Python之迭代器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E7%94%9F%E6%88%90%E5%99%A8/" class="">Python之生成器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E6%A8%A1%E5%9D%97/" class="">Python之模块</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="">Python之正则表达式</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8Bre%E6%A8%A1%E5%9D%97/" class="">Python之re模块</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" class="">面向过程与面向对象</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" class="">Python之类与对象</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E7%BB%84%E5%90%88/" class="">Python之组合</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E7%BB%A7%E6%89%BF%E5%B0%81%E8%A3%85%E5%92%8C%E5%A4%9A%E6%80%81/" class="">Python之继承、封装和多态</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E5%8F%8D%E5%B0%84/" class="">Python之反射</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E5%85%83%E7%B1%BB/" class="">Python之元类</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" class="">Python之异常处理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E5%86%85%E7%BD%AE%E7%9A%84%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/" class="">Python内置的魔术方法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="">Python网络编程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8Bsocketserver%E6%A8%A1%E5%9D%97/" class="">Python网络编程之socketserver模块</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E7%A8%8B/" class="">Python并发编程之进程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E7%BA%BF%E7%A8%8B/" class="">Python并发编程之线程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%8D%8F%E7%A8%8B/" class="">Python并发编程之协程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%AF%B9%E6%AF%94/" class="">进程、线程和协程的对比</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B%E8%BF%9B%E7%A8%8B/" class="">生产者消费者模型（进程）</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Python/Python%E4%B9%8B%E6%93%8D%E4%BD%9CMySQL%E6%95%B0%E6%8D%AE%E5%BA%93/" class="">Python之操作MySQL数据库</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ab6241a9c9348727e1ed30d9d7253a0e" class="toggle"  />
    <label for="section-ab6241a9c9348727e1ed30d9d7253a0e" class="flex justify-between">
      <a role="button" class="">Golang</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Golang/Go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" class="">Go语言编程基础</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Golang/Go%E8%AF%AD%E8%A8%80WEB%E5%BC%80%E5%8F%91/" class="">Go语言WEB开发</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Golang/Go%E8%AF%AD%E8%A8%80%E7%9A%84ORM%E6%A1%86%E6%9E%B6/" class="">Go语言的ORM框架</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a6af99c5c0ad1c9aeaecde8920e3b5e8" class="toggle"  />
    <label for="section-a6af99c5c0ad1c9aeaecde8920e3b5e8" class="flex justify-between">
      <a role="button" class="">C&#43;&#43;</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/C&#43;&#43;/C&#43;&#43;%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" class="">C&#43;&#43;编程基础</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-270a210b43b4f0ee7cd55855f0b534f3" class="toggle"  />
    <label for="section-270a210b43b4f0ee7cd55855f0b534f3" class="flex justify-between">
      <a role="button" class="">MySQL</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/MySQL/MySQL/" class="">MySQL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/MySQL/%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85MySQL%E8%84%9A%E6%9C%AC/" class="">源码安装MySQL脚本</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9fdacdda397d9ceae1a912b9128fe9e2" class="toggle" checked />
    <label for="section-9fdacdda397d9ceae1a912b9128fe9e2" class="flex justify-between">
      <a role="button" class="">PostgreSQL</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/PostgreSQL/PostgreSQL/" class=" active">PostgreSQL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/PostgreSQL/%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85PostgreSQL%E8%84%9A%E6%9C%AC/" class="">源码安装PostgreSQL脚本</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-42f4d133c66bcfbca3d930dc56eb7d01" class="toggle"  />
    <label for="section-42f4d133c66bcfbca3d930dc56eb7d01" class="flex justify-between">
      <a href="https://Huang-CH.github.io/docs/OceanBase/" class="">OceanBase</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0f85b1f743da7f4e4cb9fca119fef7be" class="toggle"  />
    <label for="section-0f85b1f743da7f4e4cb9fca119fef7be" class="flex justify-between">
      <a role="button" class="">Docker</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Docker/Docker%E5%9F%BA%E7%A1%80/" class="">Docker基础</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Docker/%E6%90%AD%E5%BB%BAHarbor%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/" class="">搭建Harbor镜像仓库</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Docker/%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85Docker/" class="">源码安装Docker</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6e638f9230da561f7c487c298451b1ed" class="toggle"  />
    <label for="section-6e638f9230da561f7c487c298451b1ed" class="flex justify-between">
      <a role="button" class="">Kubernetes</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Kubernetes/Kubernetes/" class="">Kubernetes</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-753665e91a918a680b2e12427102b0ea" class="toggle"  />
    <label for="section-753665e91a918a680b2e12427102b0ea" class="flex justify-between">
      <a role="button" class="">Prometheus</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Prometheus/Prometheus/" class="">Prometheus</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ec36ec3492308dbc4bfcaa14eb72fa33" class="toggle"  />
    <label for="section-ec36ec3492308dbc4bfcaa14eb72fa33" class="flex justify-between">
      <a role="button" class="">Git</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Git/git%E5%9F%BA%E7%A1%80/" class="">Git基础</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6304bdd2dfb0c9f0610d12cd4a0b3ffd" class="toggle"  />
    <label for="section-6304bdd2dfb0c9f0610d12cd4a0b3ffd" class="flex justify-between">
      <a role="button" class="">Ceph</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/Ceph/Ceph%E9%83%A8%E7%BD%B2%E6%89%8B%E5%86%8C/" class="">Ceph部署手册</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2044dd8220b6eb6abc8d4889684aa060" class="toggle"  />
    <label for="section-2044dd8220b6eb6abc8d4889684aa060" class="flex justify-between">
      <a role="button" class="">KVM</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://Huang-CH.github.io/docs/KVM/KVM/" class="">KVM</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="https://github.com/Huang-CH" target="_blank" rel="noopener">
        My Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>PostgreSQL</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#安装">安装</a>
      <ul>
        <li><a href="#yum-repository">Yum Repository</a></li>
        <li><a href="#apt-repository">Apt Repository</a></li>
        <li><a href="#源码编译安装source">源码编译安装（Source）</a>
          <ul>
            <li><a href="#创建用户组和用户">创建用户组和用户</a></li>
            <li><a href="#安装依赖包">安装依赖包</a></li>
            <li><a href="#下载软件并解压">下载软件并解压</a></li>
            <li><a href="#创建目录及授权">创建目录及授权</a></li>
            <li><a href="#系统参数优化">系统参数优化</a></li>
            <li><a href="#编译安装软件">编译安装软件</a></li>
            <li><a href="#初始化数据">初始化数据</a></li>
            <li><a href="#启动postgressql">启动PostgresSQL</a></li>
            <li><a href="#连接测试postgressql">连接测试PostgresSQL</a></li>
            <li><a href="#添加开机启动启动">添加开机启动启动</a></li>
            <li><a href="#卸载">卸载</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#基础管理">基础管理</a>
      <ul>
        <li><a href="#配置文件">配置文件</a></li>
        <li><a href="#启动关闭和重启服务">启动、关闭和重启服务</a>
          <ul>
            <li><a href="#启动服务">启动服务</a></li>
            <li><a href="#关闭服务">关闭服务</a></li>
            <li><a href="#重启服务">重启服务</a></li>
            <li><a href="#重新加载配置">重新加载配置</a></li>
          </ul>
        </li>
        <li><a href="#用户管理">用户管理</a>
          <ul>
            <li><a href="#创建用户">创建用户</a></li>
            <li><a href="#删除用户">删除用户</a></li>
            <li><a href="#修改用户">修改用户</a></li>
            <li><a href="#查看用户">查看用户</a></li>
          </ul>
        </li>
        <li><a href="#权限管理">权限管理</a>
          <ul>
            <li><a href="#权限级别">权限级别</a></li>
            <li><a href="#权限定义">权限定义</a></li>
          </ul>
        </li>
        <li><a href="#查看配置参数">查看配置参数</a></li>
        <li><a href="#修改配置参数">修改配置参数</a>
          <ul>
            <li><a href="#修改全局配置参数">修改全局配置参数</a></li>
            <li><a href="#修改非全配置参数">修改非全配置参数</a></li>
            <li><a href="#配置参数生效说明">配置参数生效说明</a></li>
            <li><a href="#修改日志相关配置">修改日志相关配置</a></li>
          </ul>
        </li>
        <li><a href="#psql的基本用法">psql的基本用法</a></li>
        <li><a href="#pgadmin的基本用法">pgAdmin的基本用法</a>
          <ul>
            <li><a href="#pgadmin的主要功能">pgAdmin的主要功能</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#系统表视图和函数">系统表、视图和函数</a>
      <ul>
        <li><a href="#系统表">系统表</a>
          <ul>
            <li><a href="#系统表的模式">系统表的模式</a></li>
            <li><a href="#常用的系统表">常用的系统表</a></li>
          </ul>
        </li>
        <li><a href="#系统视图">系统视图</a></li>
        <li><a href="#系统函数">系统函数</a></li>
      </ul>
    </li>
    <li><a href="#体系架构">体系架构</a>
      <ul>
        <li><a href="#存储结构">存储结构</a>
          <ul>
            <li><a href="#逻辑存储结构">逻辑存储结构</a></li>
            <li><a href="#物理存储结构">物理存储结构</a></li>
          </ul>
        </li>
        <li><a href="#进程结构">进程结构</a>
          <ul>
            <li><a href="#postmaster进程">Postmaster进程</a></li>
            <li><a href="#syslogger进程">SysLogger进程</a></li>
            <li><a href="#bgwriter进程">BgWriter进程</a></li>
            <li><a href="#walwriter进程">WALWriter进程</a></li>
            <li><a href="#pgarch进程">PgArch进程</a></li>
            <li><a href="#autovacuum进程">AutoVacuum进程</a></li>
            <li><a href="#pgstat进程">PgStat进程</a></li>
            <li><a href="#checkpoint进程">CheckPoint进程</a></li>
          </ul>
        </li>
        <li><a href="#内存结构">内存结构</a>
          <ul>
            <li><a href="#本地内存">本地内存</a></li>
            <li><a href="#共享内存">共享内存</a></li>
          </ul>
        </li>
        <li><a href="#总结">总结</a></li>
      </ul>
    </li>
    <li><a href="#postgresql优化">PostgreSQL优化</a>
      <ul>
        <li><a href="#postgresqlconf">postgresql.conf</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="简介">
  简介
  <a class="anchor" href="#%e7%ae%80%e4%bb%8b">#</a>
</h1>
<hr>
<p>PostgreSQL简称PG或PGSQL，是使用C和C++语言开发的，开源的，关系型数据库，支持多种操作系统平台，是一种比较好的Oracle数据库替代方案。</p>
<blockquote>
<p>官方网站：https://www.postgresql.org</p>
<p>中文社区：http://www.postgres.cn</p>
</blockquote>
<hr>
<h1 id="安装">
  安装
  <a class="anchor" href="#%e5%ae%89%e8%a3%85">#</a>
</h1>
<hr>
<h2 id="yum-repository">
  Yum Repository
  <a class="anchor" href="#yum-repository">#</a>
</h2>
<hr>
<blockquote>
<p>
  <a href="https://www.postgresql.org/download/linux/redhat/">PostgreSQL: Linux downloads (Red Hat family)</a></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Install the repository RPM:</span>
sudo dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm

<span style="color:#75715e"># Disable the built-in PostgreSQL module:</span>
sudo dnf -qy module disable postgresql

<span style="color:#75715e"># Install PostgreSQL:</span>
sudo dnf install -y postgresql14-server

<span style="color:#75715e"># Optionally initialize the database and enable automatic start:</span>
sudo /usr/pgsql-14/bin/postgresql-14-setup initdb
sudo systemctl enable postgresql-14
sudo systemctl start postgresql-14
</code></pre></div><hr>
<h2 id="apt-repository">
  Apt Repository
  <a class="anchor" href="#apt-repository">#</a>
</h2>
<hr>
<blockquote>
<p>
  <a href="https://www.postgresql.org/download/linux/debian/">PostgreSQL: Linux downloads (Debian)</a></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Create the file repository configuration:</span>
sudo sh -c <span style="color:#e6db74">&#39;echo &#34;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&#34; &gt; /etc/apt/sources.list.d/pgdg.list&#39;</span>

<span style="color:#75715e"># Import the repository signing key:</span>
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -

<span style="color:#75715e"># Update the package lists:</span>
sudo apt-get update

<span style="color:#75715e"># Install the latest version of PostgreSQL.</span>
<span style="color:#75715e"># If you want a specific version, use &#39;postgresql-12&#39; or similar instead of &#39;postgresql&#39;:</span>
sudo apt-get -y install postgresql
</code></pre></div><hr>
<h2 id="源码编译安装source">
  源码编译安装（Source）
  <a class="anchor" href="#%e6%ba%90%e7%a0%81%e7%bc%96%e8%af%91%e5%ae%89%e8%a3%85source">#</a>
</h2>
<hr>
<blockquote>
<p>PostgreSQL各版本下载地址：
  <a href="https://www.postgresql.org/ftp/source/">PostgreSQL: File Browser</a></p>
<p>Linux下软件源码编译安装“三板斧”：</p>
<ul>
<li>配置（<code>./configure</code>）</li>
<li>编译（<code>make</code>）</li>
<li>安装（<code>make install</code>）</li>
</ul>
<p>二进制与源码安装的区别：</p>
<ul>
<li>二进制包是官方已经完成编译，可以直接运行的程序，通过下载和解压缩软件后就可以直接使用，适用于不需要定制化的场景。</li>
<li>源代码包中是程序的源代码，需要进行编译后，生成可执行的二进制文件才可以使用，在编译时可以定制各种参数，例如：安装路径、数据路径、端口号以及其他所需的功能，自由度相较于二进制包的方式更高一些，因此适用于需要定制化的场景。（推荐）</li>
</ul>
</blockquote>
<hr>
<h3 id="创建用户组和用户">
  创建用户组和用户
  <a class="anchor" href="#%e5%88%9b%e5%bb%ba%e7%94%a8%e6%88%b7%e7%bb%84%e5%92%8c%e7%94%a8%e6%88%b7">#</a>
</h3>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">groupadd -g <span style="color:#ae81ff">1000</span> postgres
useradd -g <span style="color:#ae81ff">1000</span> -u <span style="color:#ae81ff">1000</span> postgres
</code></pre></div><hr>
<p>验证创建的用户</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">id postgres
</code></pre></div><blockquote>
<p>所有PostgreSQL的操作都要在<code>postgres</code>用户下。</p>
</blockquote>
<hr>
<h3 id="安装依赖包">
  安装依赖包
  <a class="anchor" href="#%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96%e5%8c%85">#</a>
</h3>
<hr>
<blockquote>
<p>最小依赖：gcc、gcc-c++、zlib-devel、readline-devel</p>
<p>其他依赖：perl-ExtUtils-Embed、pam-devel、libxml2-devel、libxslt-devel、openldap-devel、python-devel、openssl-devel、cmake</p>
</blockquote>
<hr>
<p>CentOS</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dnf install -y gcc readline-devel zlib-devel python-devel openssl-devel libxml2-devel libxslt-devel systemd-devel
</code></pre></div><hr>
<p>Debian</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">apt install -y gcc make readline-devel libreadline-dev zlib1g-dev python-dev libssh-dev libxml2-dev libxslt-dev libsystemd-dev systemd-devel
</code></pre></div><hr>
<h3 id="下载软件并解压">
  下载软件并解压
  <a class="anchor" href="#%e4%b8%8b%e8%bd%bd%e8%bd%af%e4%bb%b6%e5%b9%b6%e8%a7%a3%e5%8e%8b">#</a>
</h3>
<hr>
<p>下载软件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget https://ftp.postgresql.org/pub/source/v14.9/postgresql-14.9.tar.gz -P /opt/installed/
</code></pre></div><hr>
<p>校验软件的MD5值</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">md5sum postgresql-14.9.tar.gz
</code></pre></div><hr>
<p>解压软件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tar -zxvf /opt/installed/postgresql-14.9.tar.gz -C /opt/
</code></pre></div><hr>
<p>进入解压的文件目录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd /opt/postgresql-14.9/
</code></pre></div><blockquote>
<p>源码目录中的目录或文件说明：</p>
<ul>
<li>src：存放源代码的目录</li>
<li>doc：存放文档的目录</li>
<li>config：存放配置文件的目录</li>
<li>contrib：存放已打包到PostgreSQL源码中的第三方插件的源码的目录</li>
<li>aclocal.m4：区域编码配置文件</li>
<li>configure：源码安装的配置脚本</li>
<li>HISTORY：版本变更的历史记录</li>
<li>INSTALL：安装说明</li>
</ul>
</blockquote>
<hr>
<h3 id="创建目录及授权">
  创建目录及授权
  <a class="anchor" href="#%e5%88%9b%e5%bb%ba%e7%9b%ae%e5%bd%95%e5%8f%8a%e6%8e%88%e6%9d%83">#</a>
</h3>
<hr>
<p>创建PostgreSQL数据目录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir -p /home/postgres/pgsql/<span style="color:#f92672">{</span>pg_home,pg_data,pg_archive,pg_wal,pg_backup,pg_log<span style="color:#f92672">}</span>
</code></pre></div><hr>
<p>更改PostgreSQL数据目录的属主和属组</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">chown -R postgres:postgres /home/postgres/pgsql
</code></pre></div><hr>
<p>更改PostgreSQL数据目录的权限</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">chmod -R <span style="color:#ae81ff">700</span> /home/postgres/pgsql
</code></pre></div><hr>
<h3 id="系统参数优化">
  系统参数优化
  <a class="anchor" href="#%e7%b3%bb%e7%bb%9f%e5%8f%82%e6%95%b0%e4%bc%98%e5%8c%96">#</a>
</h3>
<hr>
<p>Linux操作系统内核调整，配置<code>/etc/sysctl.conf</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kernel.shmmax <span style="color:#f92672">=</span> <span style="color:#ae81ff">68719476736</span>  <span style="color:#75715e"># 默认值，以字节为单位，该参数定义了共享内存段的最大值(建议内存的80%)</span>
kernel.shmmni <span style="color:#f92672">=</span> <span style="color:#ae81ff">4096</span>  <span style="color:#75715e"># 该参数用于设置系统范围内共享内存段的最大数量</span>
kernel.shmall <span style="color:#f92672">=</span> <span style="color:#ae81ff">4294967296</span>  <span style="color:#75715e"># 默认值，以页为单位，该参数表示系统任意时刻可以分配的所有共享内存段的最大值(以页为单位)</span>

kernel.sem <span style="color:#f92672">=</span> <span style="color:#ae81ff">50100</span> <span style="color:#ae81ff">64128000</span> <span style="color:#ae81ff">50100</span> <span style="color:#ae81ff">1280</span>  
<span style="color:#75715e"># 50100表示系统范围内每个信号对象集放入最大信号对象数</span>
<span style="color:#75715e"># 64128000表示最大信号对象数</span>
<span style="color:#75715e"># 50100表示每个信号对象支持的最大操作数</span>
<span style="color:#75715e"># 1280表示系统范围内最大信号对象集数</span>

fs.file-max <span style="color:#f92672">=</span> <span style="color:#ae81ff">76724600</span>  <span style="color:#75715e"># 可使用的最大文件句柄数量,也就是可以打开最大的文件数量</span>
net.ipv4.ip_local_port_range <span style="color:#f92672">=</span> <span style="color:#ae81ff">9000</span> <span style="color:#ae81ff">65000</span>  <span style="color:#75715e"># 应用程序可以使用的IPv4端口范围</span>
net.core.rmem_default <span style="color:#f92672">=</span> <span style="color:#ae81ff">1048576</span>  <span style="color:#75715e"># 套接字接收缓冲区大小的缺省值</span>
net.core.rmem_default <span style="color:#f92672">=</span> <span style="color:#ae81ff">262144</span>  <span style="color:#75715e"># 套接字发送缓冲区大小的缺省值</span>
net.core.wmem_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">1048576</span>  <span style="color:#75715e"># 套接字发送缓冲区大小的最大值</span>
</code></pre></div><hr>
<p>使<code>/etc/sysctl.conf</code>配置生效</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sysctl -p
</code></pre></div><hr>
<p>调整Linux操作系统的资源限制，配置<code>/etc/security/limits.conf</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">* soft nofile <span style="color:#ae81ff">131072</span>  <span style="color:#75715e"># 当前系统生效的，打开文件的最大数量</span>
* hard nofile <span style="color:#ae81ff">131072</span>  <span style="color:#75715e"># 当前系统设定的，打开文件的最大数量</span>
* soft nproc <span style="color:#ae81ff">131072</span>  <span style="color:#75715e"># 当前系统生效的，开启进程的最大数量</span>
* hard nproc <span style="color:#ae81ff">131072</span>  <span style="color:#75715e"># 当前系统设定的，开启进程的最大数量</span>
* soft core unlimited  <span style="color:#75715e"># 当前系统生效的，内核文件的最大值</span>
* hard core unlimited  <span style="color:#75715e"># 当前系统设定的，内核文件的最大值</span>
* soft memlock <span style="color:#ae81ff">50000000</span>  <span style="color:#75715e"># 当前系统生效的，锁定内存地址空间的最大值</span>
* hard memlock <span style="color:#ae81ff">50000000</span>  <span style="color:#75715e"># 当前系统设定的，锁定内存地址空间的最大值</span>
</code></pre></div><blockquote>
<p>PostgreSQL与Oracle类似，是多进程的运行方式，因此生产环境下需要做一些系统参数的优化。</p>
<p>建议关闭Numa。</p>
<p>IO策略</p>
<p>机械硬盘设置为：Deadline</p>
<p>SSD硬盘设置为：Noop</p>
</blockquote>
<hr>
<h3 id="编译安装软件">
  编译安装软件
  <a class="anchor" href="#%e7%bc%96%e8%af%91%e5%ae%89%e8%a3%85%e8%bd%af%e4%bb%b6">#</a>
</h3>
<hr>
<p>配置安装参数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./configure --prefix<span style="color:#f92672">=</span>/home/postgres/pgsql/pg_home --with-openssl --with-python --with-libxml --with-libxslt --with-readline --enable-thread-safety --with-systemd
</code></pre></div><blockquote>
<p>查看可配置参数命令：<code>./configure --help</code></p>
<p>注意：</p>
<ul>
<li><code>--with-blocksize</code>的默认值是8K，如果需要对数据库进行频繁的插入操作，可以将<code>--with-blocksize</code>的值设置大一些。</li>
<li><code>--enable-dtrace</code>和<code>--enable-debug</code>生产环境下不要加。</li>
</ul>
</blockquote>
<hr>
<p>编译并安装所有功能</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">make world <span style="color:#f92672">&amp;&amp;</span> make install-world
</code></pre></div><hr>
<p>切换到<code>postgres</code>用户，并将目录切换到<code>postgres</code>用户的<code>home</code>目录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">su - postgres
</code></pre></div><hr>
<p>配置环境变量，CentOS环境变量配置文件：<code>~/.bash_profile</code>，Debian环境变量配置文件：<code>~/.bashrc</code>，追加以下内容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export PGHOME<span style="color:#f92672">=</span>/home/postgres/pgsql/pg_home
export PGDATA<span style="color:#f92672">=</span>/home/postgres/pgsql/pg_data
export LANG<span style="color:#f92672">=</span>en_US.UTF8
export LD_LIBRARY_PATH<span style="color:#f92672">=</span>/home/postgres/pgsql/pg_home/lib:$LD_LIBRARY_PATH
export DATE<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>date +<span style="color:#e6db74">&#34;%Y-%m-%d-%H:%M:%S&#34;</span><span style="color:#e6db74">`</span>
export PATH<span style="color:#f92672">=</span>/home/postgres/pgsql/pg_home/bin:$PATH
export MANPATH<span style="color:#f92672">=</span>/home/postgres/pgsql/pg_home/share/man:$MANPATH
export PGUSER<span style="color:#f92672">=</span>postgres
</code></pre></div><hr>
<p>以Debian环境为例，使环境变量生效</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">source ~/.bashrc
</code></pre></div><hr>
<p>验证环境变量和安装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">psql --version
</code></pre></div><hr>
<h3 id="初始化数据">
  初始化数据
  <a class="anchor" href="#%e5%88%9d%e5%a7%8b%e5%8c%96%e6%95%b0%e6%8d%ae">#</a>
</h3>
<hr>
<p>切换到<code>postgres</code>用户</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">su - postgres
</code></pre></div><hr>
<p>初始化数据（创建数据库实例）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">initdb -D /home/postgres/pgsql/pg_data -E UTF8 --locale<span style="color:#f92672">=</span>C -U postgres -W
</code></pre></div><blockquote>
<p>添加<code>-W</code>参数会在初始化的过程中提示输入数据库超级用户的密码，默认情况下该密码为空，生产环境下建议添加该参数。</p>
</blockquote>
<hr>
<h3 id="启动postgressql">
  启动PostgresSQL
  <a class="anchor" href="#%e5%90%af%e5%8a%a8postgressql">#</a>
</h3>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pg_ctl -D $PGDATA -l logfile start
</code></pre></div><blockquote>
<p><code>pg_ctl --help</code></p>
</blockquote>
<hr>
<h3 id="连接测试postgressql">
  连接测试PostgresSQL
  <a class="anchor" href="#%e8%bf%9e%e6%8e%a5%e6%b5%8b%e8%af%95postgressql">#</a>
</h3>
<hr>
<blockquote>
<p>PostgresSQL默认只允许本地Socket连接</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">psql
</code></pre></div><hr>
<h3 id="添加开机启动启动">
  添加开机启动启动
  <a class="anchor" href="#%e6%b7%bb%e5%8a%a0%e5%bc%80%e6%9c%ba%e5%90%af%e5%8a%a8%e5%90%af%e5%8a%a8">#</a>
</h3>
<hr>
<p>将<code>/opt/installed/postgresql-14.9/contrib/start-scripts/</code>目录下的<code>linux</code>脚本文件重命名为<code>postgresql</code>。</p>
<p>可以将postgresql启动脚本放到<code>/etc/init.d</code>目录下，然后使用<code>chkconfig --add postgresql</code>命令，将<code>postgresql</code>启动脚本添加到启动服务。</p>
<p>也可以编写<code>postgresql.service</code>的systemd服务配置文件，放到<code>/etc/systemd/system/</code>目录下，然后使用<code>systemctl enable postgresql</code>命令将<code>postgresql</code>启动脚本添加到启动服务。</p>
<blockquote>
<p>systemd服务配置文件范例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
Description<span style="color:#f92672">=</span>PostgreSQL Server
After<span style="color:#f92672">=</span>network.target

<span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
Type<span style="color:#f92672">=</span>forking
ExecStart<span style="color:#f92672">=</span>/home/postgres/pgsql/pg_home/bin/pg_ctl -D /home/postgres/pgsql/pg_data start
User<span style="color:#f92672">=</span>postgres
Group<span style="color:#f92672">=</span>postgres

<span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
WantedBy<span style="color:#f92672">=</span>multi-user.target
</code></pre></div><p>systemd的使用大幅提高了系统服务的运行效率, 而unit的文件位置一般主要有三个目录：</p>
<p><code>/etc/systemd/system</code></p>
<p><code>/run/systemd/system</code></p>
<p><code>/lib/systemd/system</code></p>
<p>这三个目录的配置文件优先级依次从高到低，如果同一选项三个地方都进行了配置了，优先级高的会覆盖优先级低的。</p>
</blockquote>
<hr>
<h3 id="卸载">
  卸载
  <a class="anchor" href="#%e5%8d%b8%e8%bd%bd">#</a>
</h3>
<hr>
<p>卸载编译安装的PostgreSQL有三种方式：</p>
<ul>
<li>删除安装目录。如果编译安装时使用了<code>--prefix</code>指定了安装目录，直接将这个安装目录删除就可以完成卸载。</li>
<li>执行卸载程序。如果编译安装时没有使用了<code>--prefix</code>安装目录，进入软件解压后的目录，执行<code>sudo make uninstall</code>命令进行反编译。</li>
<li>搜索相关目录进行删除。使用<code>whereis postgresql</code>命令将找到目录都删除。</li>
</ul>
<hr>
<h1 id="基础管理">
  基础管理
  <a class="anchor" href="#%e5%9f%ba%e7%a1%80%e7%ae%a1%e7%90%86">#</a>
</h1>
<hr>
<h2 id="配置文件">
  配置文件
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6">#</a>
</h2>
<hr>
<p>PostgreSQL三大配置文件：</p>
<ul>
<li><code>pg_hba.conf</code>：访问控制文件，路径：<code>/home/postgres/pgsql/pg_data/pg_hba.conf</code>。</li>
<li><code>postgresql.conf</code>：全局配置文件，路径：<code>/home/postgres/pgsql/pg_data/postgresql.conf</code>。</li>
<li><code>postgresql.auto.conf</code>：在数据库运行时修改配置保存的配置文件（建议不要手动修改），路径：<code>/home/postgres/pgsql/pg_data/postgresql.auto.conf</code>。</li>
</ul>
<hr>
<p>PostegreSQL安装完毕之后，默认情况下只允许从本机连接数据库，若需要其他主机连接到数据库，需要修改配置文件：<code>/home/postgres/pgsql/pg_data/pg_hba.conf</code>进行访问控制，该配置问文件共有5个参数，TYPE（主机类型）、DATABASE（数据库名）、USER（用户名）、ADDRESS（IP地址和子网掩码）、METHOD（加密方法）</p>
<p>TYPE中的关键字</p>
<ul>
<li><code>local</code>：表示匹配规则为使用Unix域套接字。如果TYPE中没有为<code>local</code>的条目，则不允许通过Unix域套接字连接。</li>
<li><code>host</code>：表示匹配规则为使用TCP/IP建立的连接，同时匹配SSL和非SSL的连接。</li>
<li><code>hostssl</code>：表示匹配规则为必须使用SSL的TCP/IP连接。客户端和服务器都需要安装OpenSSL，在使用<code>./configure</code>配置安装参数的时候需要添加<code>--with-openssl</code>参数，开启SSL支持，同时需要在<code>postgresql.conf</code>文件中配置<code>ssl = on</code>。</li>
<li><code>hostnossl</code>：表示匹配规则为只使用非SSL的TCP/IP连接。</li>
</ul>
<p>METHOM的关键字</p>
<ul>
<li><code>trust</code>：表示无条件允许（信任）连接。允许任何可以与PostgreSQL数据库服务器连接的用户身份登入。如果规则允许，甚至可以不需要任何口令或者认证进行登入。</li>
<li><code>reject</code>：表示无条件拒绝连接。常用于拒绝一个组中的特定主机，在下一行允许其余主机的连接。</li>
<li><code>password</code>：表示使用明文密码的方式。注意在非信任网络环境中禁止使用password方式。</li>
<li><code>md5</code>：表示使用双重md5加密的方式。</li>
<li><code>scram-sha-256</code>：生产环境建议使用这种加密方式</li>
<li><code>peer</code>：表示从本地操作系统中获取系统用户，并检查它是否与请求连接的数据库用户匹配，但仅限于本地连接。</li>
<li>其他连接方式参见：https://www.postgresql.org/docs/current/static/auth-methods.html。</li>
</ul>
<hr>
<p>PostegreSQL安装完毕之后，默认情况下只监听本地localhost的连接，不允许使用TCP/IP连接，若启用远程连接，需要修改主配置文件：<code>/home/postgres/pgsql/pg_data/postgresql.conf</code>的<code>listen_adresses</code>监听地址。<code>postgresql.conf</code>配置文件的结构为<code>key = value</code>的形式，value的值支持布尔类型、整数类型、浮点数类型、字符串类型、枚举类型和include指令（允许嵌套）。</p>
<blockquote>
<p>注意：</p>
<p><code>value</code>的参数值为数字类型的时候可以直接写，其他类型的参数值最好以单引号包围，避免参数值无法识别。</p>
<p>如果参数值本身包含单引号，可以使用单引号（推荐）或反斜杠包围。</p>
</blockquote>
<hr>
<p>在<code>/home/postgres/pgsql/pg_data/pg_hba.conf</code>配置文件中增加如下内容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">host      all      all      0.0.0.0/0      scram-sha-256
</code></pre></div><hr>
<p>在<code>/home/postgres/pgsql/pg_data/postgresql.conf</code>配置文件中修改如下内容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 监听IP地址</span>
listen_addresses <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;*&#39;</span>
<span style="color:#75715e"># 端口号</span>
port <span style="color:#f92672">=</span> <span style="color:#ae81ff">5432</span>
<span style="color:#75715e"># 开启归档模式</span>
archive_mode <span style="color:#f92672">=</span> on
<span style="color:#75715e"># 归档命令</span>
archive_command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cp %p /home/postgres/pgsql/pg_wal/%f&#39;</span>
<span style="color:#75715e"># 开启日志收集</span>
logging_collector <span style="color:#f92672">=</span> on
<span style="color:#75715e"># 指定日志记录方式，共有三种方式，分别为stderr、csvlog和syslog</span>
log_destination <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;csvlog&#39;</span>
<span style="color:#75715e"># 指定日志文件名称</span>
log_filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;postgresql-%Y-%m-%d.log&#39;</span>
<span style="color:#75715e"># 开启日志截断</span>
log_truncate_on_rotation <span style="color:#f92672">=</span> on
<span style="color:#75715e"># 日志轮询时间，单位：分钟</span>
log_rotation_age <span style="color:#f92672">=</span> <span style="color:#ae81ff">1440</span>
<span style="color:#75715e"># 日志轮询大小，0表示禁用基于尺寸的新日志文件创建</span>
log_rotation_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#75715e"># 用于检测语句运行时间，-1则表示停止记录语句持续时间</span>
log_min_duration_statement <span style="color:#f92672">=</span> -1
<span style="color:#75715e"># 开启日志检查点</span>
log_checkpoints <span style="color:#f92672">=</span> on
<span style="color:#75715e"># 开启会话连接日志</span>
log_connections <span style="color:#f92672">=</span> on
<span style="color:#75715e"># 开启会话终断日志</span>
log_disconnections <span style="color:#f92672">=</span> on
<span style="color:#75715e"># 日志记录的细节量，有三种方式，分别为TERSE、DEFAULT和VERBOSE</span>
log_error_verbosity <span style="color:#f92672">=</span> verbose
<span style="color:#75715e"># 日志记录会话锁等待时间</span>
log_lock_waits <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
<span style="color:#75715e"># 日志中写入的时间戳的时区</span>
log_timdezone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;PRC&#39;</span>
</code></pre></div><hr>
<h2 id="启动关闭和重启服务">
  启动、关闭和重启服务
  <a class="anchor" href="#%e5%90%af%e5%8a%a8%e5%85%b3%e9%97%ad%e5%92%8c%e9%87%8d%e5%90%af%e6%9c%8d%e5%8a%a1">#</a>
</h2>
<hr>
<h3 id="启动服务">
  启动服务
  <a class="anchor" href="#%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pg_ctl -D /home/postgres/pgsql/pg_data -l logfile start
</code></pre></div><hr>
<h3 id="关闭服务">
  关闭服务
  <a class="anchor" href="#%e5%85%b3%e9%97%ad%e6%9c%8d%e5%8a%a1">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pg_ctl stop -m fast
</code></pre></div><hr>
<h3 id="重启服务">
  重启服务
  <a class="anchor" href="#%e9%87%8d%e5%90%af%e6%9c%8d%e5%8a%a1">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pg_ctl restart -m fast
</code></pre></div><hr>
<h3 id="重新加载配置">
  重新加载配置
  <a class="anchor" href="#%e9%87%8d%e6%96%b0%e5%8a%a0%e8%bd%bd%e9%85%8d%e7%bd%ae">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pg_ctl reload
</code></pre></div><hr>
<h2 id="用户管理">
  用户管理
  <a class="anchor" href="#%e7%94%a8%e6%88%b7%e7%ae%a1%e7%90%86">#</a>
</h2>
<hr>
<h3 id="创建用户">
  创建用户
  <a class="anchor" href="#%e5%88%9b%e5%bb%ba%e7%94%a8%e6%88%b7">#</a>
</h3>
<hr>
<blockquote>
<p>使用<code>\help create user user;</code>获取帮助</p>
</blockquote>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#960050;background-color:#1e0010">用户名</span>;
</code></pre></div><blockquote>
<p>使用<code>CREATE ROLE 用户名;</code>也可以创建用户，但创建出来的用户不带有<code>LOGIN</code>权限。</p>
</blockquote>
<p>创建用户时授权管理员权限（SUPERUSER），并设置密码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#960050;background-color:#1e0010">用户名</span> <span style="color:#66d9ef">WITH</span> SUPERUSER <span style="color:#66d9ef">PASSWORD</span> <span style="color:#e6db74">&#39;密码&#39;</span>;
</code></pre></div><hr>
<h3 id="删除用户">
  删除用户
  <a class="anchor" href="#%e5%88%a0%e9%99%a4%e7%94%a8%e6%88%b7">#</a>
</h3>
<hr>
<blockquote>
<p>使用<code>\help drop user;</code>获取帮助</p>
</blockquote>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">USER</span> <span style="color:#960050;background-color:#1e0010">用户名</span>;
</code></pre></div><hr>
<h3 id="修改用户">
  修改用户
  <a class="anchor" href="#%e4%bf%ae%e6%94%b9%e7%94%a8%e6%88%b7">#</a>
</h3>
<hr>
<blockquote>
<p>使用<code>\help alter user;</code>获取帮助</p>
</blockquote>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">修改用户密码</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">USER</span> <span style="color:#960050;background-color:#1e0010">用户名</span> <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">PASSWORD</span> <span style="color:#e6db74">&#39;密码&#39;</span>;
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">修改用户权限</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">USER</span> <span style="color:#960050;background-color:#1e0010">用户名</span> <span style="color:#66d9ef">WITH</span> NOSUPERUSER;
</code></pre></div><hr>
<h3 id="查看用户">
  查看用户
  <a class="anchor" href="#%e6%9f%a5%e7%9c%8b%e7%94%a8%e6%88%b7">#</a>
</h3>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#960050;background-color:#1e0010">\</span>du
</code></pre></div><hr>
<h2 id="权限管理">
  权限管理
  <a class="anchor" href="#%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86">#</a>
</h2>
<hr>
<h3 id="权限级别">
  权限级别
  <a class="anchor" href="#%e6%9d%83%e9%99%90%e7%ba%a7%e5%88%ab">#</a>
</h3>
<hr>
<p>Cluster权限：实例级别的权限通过<code>pg_hba.conf</code>进行配置。</p>
<p>Datebase权限：数据库级别的权限通过<code>GRANT</code>和<code>REVOKE</code>命令对Schema进行配置。</p>
<p>TableSpeace权限：表空间权限通过<code>GRANT</code>和<code>REVOKE</code>命令进行操作表、视图、索引等。</p>
<p>Schema权限：模式权限通过<code>GRANT</code>和<code>REVOKE</code>命令进行操作。</p>
<p>Object权限：对象权限通过<code>GRANT</code>和<code>REVOKE</code>命令进行操作。</p>
<hr>
<h3 id="权限定义">
  权限定义
  <a class="anchor" href="#%e6%9d%83%e9%99%90%e5%ae%9a%e4%b9%89">#</a>
</h3>
<hr>
<p>Datebases授权</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#960050;background-color:#1e0010">数据库</span> <span style="color:#66d9ef">TO</span> <span style="color:#960050;background-color:#1e0010">用户名</span>;
</code></pre></div><hr>
<p>Schema授权</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SCHEMA</span> Schema名称 <span style="color:#66d9ef">OWNER</span> <span style="color:#66d9ef">to</span> <span style="color:#960050;background-color:#1e0010">用户名</span>;
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">select</span>,<span style="color:#66d9ef">insert</span>,<span style="color:#66d9ef">update</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">TABLES</span> <span style="color:#66d9ef">IN</span> <span style="color:#66d9ef">SCHEMA</span> Schema名称 <span style="color:#66d9ef">TO</span> <span style="color:#960050;background-color:#1e0010">用户名</span>; 
</code></pre></div><hr>
<p>Object授权</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">Grant</span> <span style="color:#66d9ef">select</span>,<span style="color:#66d9ef">insert</span>,<span style="color:#66d9ef">update</span> <span style="color:#66d9ef">ON</span> <span style="color:#960050;background-color:#1e0010">数据库</span><span style="color:#ae81ff">.</span><span style="color:#960050;background-color:#1e0010">数据表</span> <span style="color:#66d9ef">TO</span> <span style="color:#960050;background-color:#1e0010">用户名</span>;
</code></pre></div><hr>
<h2 id="查看配置参数">
  查看配置参数
  <a class="anchor" href="#%e6%9f%a5%e7%9c%8b%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0">#</a>
</h2>
<hr>
<p>在数据库中，通过<code>SHOW ALL;</code>命令可以查看当前数据的所有配置参数。</p>
<p>通过<code>\d pg_settings</code>命令可以查看到<code>pg_setting</code>视图中都有哪些字段。</p>
<p>而通过<code>select name, context, setting, min_val, max_val, unit from pg_settings;</code>命令查询<code>pg_setting</code>视图,可以查询到更加详细的配置参数和实现方法。</p>
<hr>
<h2 id="修改配置参数">
  修改配置参数
  <a class="anchor" href="#%e4%bf%ae%e6%94%b9%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0">#</a>
</h2>
<hr>
<p>修改配置可以分为全局和非全局。</p>
<hr>
<h3 id="修改全局配置参数">
  修改全局配置参数
  <a class="anchor" href="#%e4%bf%ae%e6%94%b9%e5%85%a8%e5%b1%80%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0">#</a>
</h3>
<hr>
<p>修改全局配置可以通过以下方法实现：</p>
<ul>
<li>通过Linux命令（<code>vim</code>、<code>echo</code>、<code>sed</code>）修改全局配置文件</li>
<li>启动时设置（不推荐，除非进入单用户模式）</li>
<li>通过在操作系统中通过<code>psql -c configparameter=newvalue</code>命令修改全局配置</li>
<li>在PostgreSQL中通过<code>ALTER SYSTEM</code>命令修改全局配置，可以通过<code>\h ALTER SYSTEM</code>命令获取帮助</li>
</ul>
<hr>
<h3 id="修改非全配置参数">
  修改非全配置参数
  <a class="anchor" href="#%e4%bf%ae%e6%94%b9%e9%9d%9e%e5%85%a8%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0">#</a>
</h3>
<hr>
<ul>
<li>数据库（Database）级别：使用<code>ALTER DATABASE</code>命令。</li>
<li>会话（Session）级别：使用<code>SET</code>命令。</li>
<li>用户（User/Role）级别：使用<code>ALTER ROLE</code>命。通过pg_user和pg_db_role_setting数据表可以查询到某个参数在用户级别的设置信息。</li>
</ul>
<hr>
<h3 id="配置参数生效说明">
  配置参数生效说明
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0%e7%94%9f%e6%95%88%e8%af%b4%e6%98%8e">#</a>
</h3>
<hr>
<p>在数据库中，使用以下命令可以查看各个参数的上下文（context）配置说明</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">distinct</span>(context), <span style="color:#66d9ef">name</span> <span style="color:#66d9ef">FROM</span> pg_settings;
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:center">context</th>
<th style="text-align:center">生效方式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">sighup</td>
<td style="text-align:center">给服务器发送HUP信号会使服务器重新加载<code>postgresql.conf</code>配置，立即生效</td>
</tr>
<tr>
<td style="text-align:center">postmaster</td>
<td style="text-align:center">重启服务后生效</td>
</tr>
<tr>
<td style="text-align:center">internal</td>
<td style="text-align:center">重新编译才能生效</td>
</tr>
<tr>
<td style="text-align:center">backend</td>
<td style="text-align:center">启用新会话后生效</td>
</tr>
<tr>
<td style="text-align:center">superuser</td>
<td style="text-align:center">超级用户才能修改，立即生效</td>
</tr>
<tr>
<td style="text-align:center">user</td>
<td style="text-align:center">只影响该用户的会话</td>
</tr>
</tbody>
</table>
<p>使配置生效方法主要有以下四种：</p>
<ul>
<li>使用超级用户，在数据库中执行<code>SELECT pg_reload_conf();</code>命令使修改的配置生效。</li>
<li>在操作系统中使用<code>pg_ctl reload</code>命令触发sighup信号使修改的配置生效。</li>
<li>通过Linux的kill命令，手动发起HUP信号，<code>ps -ef | grep -i postmaster | grep -v grep | xargs kill -HUP</code>。</li>
<li>在操作系统中通过<code>pg_ctl restart</code>命令重启数据库使修改的配置生效。</li>
</ul>
<hr>
<h3 id="修改日志相关配置">
  修改日志相关配置
  <a class="anchor" href="#%e4%bf%ae%e6%94%b9%e6%97%a5%e5%bf%97%e7%9b%b8%e5%85%b3%e9%85%8d%e7%bd%ae">#</a>
</h3>
<hr>
<p>数据库运行日志相关的参数可以在<code>postgresql.auto.conf</code>文件中进行配置和修改，该文件不能直接编辑，需要在数据库中通过<code>ALTER SYSTEM</code>命令进行参数的配置和修改。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> logging_collector <span style="color:#f92672">=</span> <span style="color:#66d9ef">on</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">开启日志控制器</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> log_destination <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;csvlog&#39;</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">设置日志的存储格式</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> log_directory <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;log&#39;</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">设置日志存储的目录</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> log_filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;postgresql_%Y-%m-%d_%H%M%S.log&#39;</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">设置日志名称</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> log_rotation_age <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1d&#39;</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">设置每天生成一个新的日志</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> log_rotation_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">不限制单个日志文件的大小</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> log_truncate_on_rotation <span style="color:#f92672">=</span> <span style="color:#66d9ef">on</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">控制日志文件存在时，是否覆盖日志文件</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> log_hostname <span style="color:#f92672">=</span> <span style="color:#66d9ef">on</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">控制是否记录客户端的主机名</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> log_line_prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%m %p %u %d %r&#39;</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">设置日志内容输出的格式，默认为空</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> log_statement <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;all&#39;</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">控制日志记录哪些</span>SQL语句<span style="color:#960050;background-color:#1e0010">。可设置为：</span><span style="color:#66d9ef">none</span><span style="color:#960050;background-color:#1e0010">、</span>ddl<span style="color:#960050;background-color:#1e0010">、</span>mod<span style="color:#960050;background-color:#1e0010">、</span>all等
</code></pre></div><blockquote>
<p>参数修改完成，需要重启数据库后生效</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pg_ctl restart -m fast
</code></pre></div></blockquote>
<hr>
<p>WAL和归档日志相关的参数也是在<code>postgresql.auto.conf</code>文件中进行配置和修改。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> wal_level <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;replica&#39;</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">控制写入到</span>WAL的信息量
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> archive_mode <span style="color:#f92672">=</span> <span style="color:#66d9ef">on</span>;  <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">允许使用</span>archive_command命令将完成的WAL段发送到归档存储<span style="color:#960050;background-color:#1e0010">。</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">SYSTEM</span> <span style="color:#66d9ef">SET</span> archive_command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;test ! -f /mnt/pgsql/pg_wal/%f &amp;&amp; cp %p /mnt/pgsql/pg_wal/%f&#34;</span>;
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">执行本地</span>shell命令来归档一个完成的WAL文件段<span style="color:#960050;background-color:#1e0010">。字符串中的任何</span><span style="color:#f92672">%</span>p都会被替换为被归档文件的路径名,<span style="color:#960050;background-color:#1e0010">而</span><span style="color:#f92672">%</span>f只被文件名替换<span style="color:#960050;background-color:#1e0010">（路径名是相对于服务器的工作目录，即集簇的数据目录）。如果要在命令里嵌入一个真正的</span><span style="color:#f92672">%</span><span style="color:#960050;background-color:#1e0010">字符，可以使用</span><span style="color:#f92672">%%</span><span style="color:#960050;background-color:#1e0010">。有一点很重要，该命令只在成功时返回一个零作为退出状态。</span>
</code></pre></div><blockquote>
<p>参数修改完成，需要重启数据库后生效</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pg_ctl restart -m fast
</code></pre></div></blockquote>
<hr>
<h2 id="psql的基本用法">
  psql的基本用法
  <a class="anchor" href="#psql%e7%9a%84%e5%9f%ba%e6%9c%ac%e7%94%a8%e6%b3%95">#</a>
</h2>
<hr>
<blockquote>
<p>psql的官方介绍：https://www.postgresql.org/docs/current/app-psql.html</p>
</blockquote>
<hr>
<p>psql是PostgreSQL的一个交互式的命令行终端，通过使用私有的元命令（内置命令）或通用的SQL语句对数据库对象进行管理。在psql中可以通过<code>tab</code>键自动补全命令，还可以查看执行命令的历史记录。</p>
<p>在系统终端中运行psql时，可以通过<code>psql --help</code>命令获取到所有的参数信息。</p>
<p>通过psql使用IP地址连接PostgreSQL数据库示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">psql -h 192.168.1.100 -p <span style="color:#ae81ff">5432</span> -U postgres -d postgres
</code></pre></div><p>通过psql查看PostgreSQL的版本信息：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">psql -V
</code></pre></div><p>通过psql查看创建的数据库列表：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">psql -l
</code></pre></div><p>通过psql连接到默认数据库，并且使用元命令的时候将其翻译成标准的SQL语句：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">psql -E
</code></pre></div><p>在psql中所有以反斜杠<code>\</code>开始的命令都是元命令，是只有psql能够处理的私有命令（方言），通过这些元命令可以让psql的管理更加高效。psql的常用命令有：</p>
<p><code>\?</code>：显示PostgreSQL客户端所有以<code>\</code>开头的内置命令。</p>
<p><code>\? options</code>：显示psql命令的帮助信息，与在系统中执行<code>psql --help</code>命令结果一致。</p>
<p><code>\? variables</code>：显示psql变量的帮助信息。</p>
<p><code>\h</code>：显示SQL命令的帮助信息。</p>
<p><code>\h</code>：后面跟需要显示帮助信息的SQL语句，后面跟<code>*</code>可以查询所有SQL语句的帮助信息。</p>
<p><code>\l</code>：相当于MySQL的<code>show databases;</code>，用来查询现有的数据库信息。</p>
<p><code>\c</code>：相当于MySQL的<code>use tablename;</code>，切换到指定的数据库。</p>
<p><code>\d</code>：显示数据库中所有的数据表。</p>
<p><code>\d+</code>：显示数据库中所有的数据表的详细信息。</p>
<p><code>\d 数据表</code>：显示数据表结构。</p>
<p><code>\du</code>：查询用户信息。</p>
<p><code>\x</code>：将信息竖着显示。</p>
<p>使用<code>SELECT * FROM pg_tables;</code>可以查询所有表的信息。</p>
<hr>
<h2 id="pgadmin的基本用法">
  pgAdmin的基本用法
  <a class="anchor" href="#pgadmin%e7%9a%84%e5%9f%ba%e6%9c%ac%e7%94%a8%e6%b3%95">#</a>
</h2>
<hr>
<blockquote>
<p>pgAdmin is the most popular and feature rich Open Source administration and development platform for PostgreSQL, the most advanced Open Source database in the world.</p>
<p>官方网站：https://www.pgadmin.org</p>
</blockquote>
<hr>
<h3 id="pgadmin的主要功能">
  pgAdmin的主要功能
  <a class="anchor" href="#pgadmin%e7%9a%84%e4%b8%bb%e8%a6%81%e5%8a%9f%e8%83%bd">#</a>
</h3>
<hr>
<ul>
<li>连接数据库，并通过图形化界面管理数据库和对象</li>
<li>备份、恢复数据库以及维护数据库</li>
<li>执行SQL操作，查看和分析SQL的执行计划</li>
</ul>
<hr>
<h1 id="系统表视图和函数">
  系统表、视图和函数
  <a class="anchor" href="#%e7%b3%bb%e7%bb%9f%e8%a1%a8%e8%a7%86%e5%9b%be%e5%92%8c%e5%87%bd%e6%95%b0">#</a>
</h1>
<hr>
<h2 id="系统表">
  系统表
  <a class="anchor" href="#%e7%b3%bb%e7%bb%9f%e8%a1%a8">#</a>
</h2>
<hr>
<p>系统表是存放系统信息的数据表或者视图，PostgreSQL中共包括56张系统表和23个系统视图，系统视图通过系统表所创建。</p>
<p>PostgreSQL的每一个数据库都有自己的一套系统表，其中大多数系统表是在创建数据库时从模板数据库中拷贝而来的，这些系统表中的数据都与所属数据库相关；少数系统表是通过共享的方式给所有数据库使用（例如：<code>pg_database</code>），这些系统表中的数据与所有数据库都有相关。</p>
<p>由于系统表保存了数据库的所有元数据，所以系统运行时对系统表的访问是非常频繁的，为了提高性能，在内存中建立了共享系统表的Cache，使用Hash函数和Hash表来提高查询效率。</p>
<p>以<code>pg_</code>开头的表或视图是系统表或系统视图。</p>
<p>用户可以但不应该手工修改系统表，修改系统表有可能导致系统信息不一致，应由系统自动维护系统表。</p>
<hr>
<h3 id="系统表的模式">
  系统表的模式
  <a class="anchor" href="#%e7%b3%bb%e7%bb%9f%e8%a1%a8%e7%9a%84%e6%a8%a1%e5%bc%8f">#</a>
</h3>
<hr>
<p>除了public和用户创建的模式之外，每个数据库都包含一个<code>pg_catalog</code>模式，默认情况下是隐藏起来的，它包含系统表和所有内置数据类型、函数和操作符。</p>
<p><code>pg_catalog</code>是搜索路径中的一部分，如果他没有明确出现在搜索路径中，那么它会隐含地在路径模式之前搜索。</p>
<p>在PostgreSQL中通过<code>\dS</code>命令，可以打印出<code>pg_catalog</code>模式中所有以<code>pg_</code>开头的系统表。</p>
<hr>
<h3 id="常用的系统表">
  常用的系统表
  <a class="anchor" href="#%e5%b8%b8%e7%94%a8%e7%9a%84%e7%b3%bb%e7%bb%9f%e8%a1%a8">#</a>
</h3>
<hr>
<h4 id="pg_authid">
  <code>pg_authid</code>
  <a class="anchor" href="#pg_authid">#</a>
</h4>
<blockquote>
<p>用于存储数据库用户的详细信息。</p>
<p>包括是否是超级用户、是否允许登录、密码、密码失效时间等。因为用户标识是集群范围的，因此<code>pg_authid</code> 在一个集群里所有的数据库之间是共享的：每个集群只有一个 <code>pg_authid</code> 拷贝，而不是每个数据库一个。</p>
</blockquote>
<p>字段描述：</p>
<p><code>rolname</code>：角色名称。</p>
<p><code>rolsuper</code>：角色拥有超级用户权限。</p>
<p><code>rolinherit</code>：角色自动继承其所属角色的权限。</p>
<p><code>rolcreaterole</code>：角色可以创建更多角色。\</p>
<p><code>rolcreatedb</code>：角色可以创建数据库。</p>
<p><code>rolcatupdate</code>：角色可以直接更新系统表。如果没有设置这个字段为真，即使超级用户也不能这么做。</p>
<p><code>rolcanlogin</code>：角色可以登录，也就是说，这个角色可以给予会话认证标识符。</p>
<p><code>rolconnlimit</code>：对于可以登录的角色，限制其最大并发连接数量。-1 表示没有限制。</p>
<p><code>rolpassword</code>：口令(可能是加密的)；如果没有则为 NULL。</p>
<p><code>rolvaliduntil</code>：口令失效时间(只用于口令认证)；如果没有失效期，则为 NULL。</p>
<hr>
<h4 id="pg_auth_members">
  <code>pg_auth_members</code>
  <a class="anchor" href="#pg_auth_members">#</a>
</h4>
<blockquote>
<p>用于存储数据库用户的成员关系信息。</p>
<p>任何非闭环的关系集合都是允许的。因为用户标识是集群范围的，<code>pg_auth_members</code> 是在一个集群里的所有数据库之间共享的：每个集群里只有一个 <code>pg_auth_members</code> 拷贝，而不是每个数据库一个。</p>
</blockquote>
<p>字段描述：</p>
<p><code>roleid</code>：拥有有成员的角色的 ID。</p>
<p><code>member</code>：属于 roleid 角色的一个成员的角色的 ID。</p>
<p><code>grantor</code>：赋予此成员关系的角色的 ID。</p>
<hr>
<h4 id="pg_database">
  <code>pg_database</code>
  <a class="anchor" href="#pg_database">#</a>
</h4>
<blockquote>
<p>用于存储集群中的数据库信息。</p>
<p>和大多数系统表不同，<code>pg_database</code> 是在一个集群里的所有数据库共享的：每个集群只有一份 pg_database 拷贝，而不是每个数据库一份。</p>
</blockquote>
<p>字段描述：</p>
<p><code>datname</code>：数据库名。</p>
<p><code>datdba</code>：数据库所有人，通常为其创建者。</p>
<hr>
<h4 id="pg_class">
  <code>pg_class</code>
  <a class="anchor" href="#pg_class">#</a>
</h4>
<blockquote>
<p>几乎包括了数据库的有所对象信息。（非常重要）</p>
<p>包括索引(需要参阅 pg_index)、序列、视图、复合类型和一些特殊关系类型。</p>
<p><code>pg_class</code>是一个对象表，表的每一个字段都是<code>rel</code>开头，<code>rel</code>是<code>relation</code>的缩写。</p>
</blockquote>
<p>字段描述：</p>
<p><code>relname</code>：表、索引、视图等的名字。</p>
<p><code>relnamespace</code>：包含这个关系的名字空间(模式)的 OID。</p>
<p>relpersistence：p = 永久表，u = 无日志表， t = 临时表。</p>
<p><code>relkind</code>：r = 普通表， i = 索引， S = 序列， t = TOAST表， v = 视图， m = 物化视图， c = 组合类型， f = 外部表， p = 分区表， I = 分区索引。</p>
<hr>
<h4 id="pg_description">
  <code>pg_description</code>
  <a class="anchor" href="#pg_description">#</a>
</h4>
<blockquote>
<p>用于存储数据库对象的描述信息。</p>
<p>可以使用 <code>comment</code> 命令操作这些描述，并且可以用 psql 的 <code>\d</code> 命令查看。许多内置的系统对象的描述提供了 <code>pg_description</code> 的初始内容。</p>
</blockquote>
<p>字段描述：</p>
<p><code>objoid</code>：这条描述所描述的对象的 OID。</p>
<p><code>classoid</code>：这个对象出现的系统表的 OID。</p>
<p><code>objsubid</code>：对于一个表字段的注释，它是字段号(objoid 和 classoid 指向表自身)。对于其它对象类型，它是零。</p>
<p><code>description</code>：作为对该对象的描述的任意文本。</p>
<hr>
<h4 id="pg_index">
  <code>pg_index</code>
  <a class="anchor" href="#pg_index">#</a>
</h4>
<blockquote>
<p>用于存储索引的具体信息</p>
</blockquote>
<p>字段描述：</p>
<p>indexrelid：索引在<code>pg_class</code>里记录的oid。</p>
<p>indrelid：使用这个表在<code>pg_class</code>里的记录的oid。</p>
<hr>
<h4 id="pg_tablespace">
  <code>pg_tablespace</code>
  <a class="anchor" href="#pg_tablespace">#</a>
</h4>
<blockquote>
<p>用于存储有关可用表空间的信息。</p>
<p>表可以放置在特定的表空间里，以帮助管理磁盘布局。与大多数系统表不同，<code>pg_tablespace</code> 在一个集群中的所有数据库之间共享：每个集群只有一份 <code>pg_tablespace</code> 的拷贝，而不是每个数据库一个。</p>
</blockquote>
<p>字段描述：</p>
<p><code>spcname</code>：表空间名。</p>
<p>spcowner：表空间的所有者。</p>
<hr>
<h4 id="pg_namespace">
  <code>pg_namespace</code>
  <a class="anchor" href="#pg_namespace">#</a>
</h4>
<blockquote>
<p>用于存储名称空间，包括模式信息。</p>
<p>名称空间是 SQL 模式下层的结构：每个名称空间有独立的关系、类型等集合，但并不会相互冲突。</p>
<p>PostgreSQL的名称空间层次是：数据库 -&gt; 模式 -&gt; 表 -&gt; 属性</p>
</blockquote>
<p>字段描述：</p>
<p><code>nspnamce</code>：名空间名称。</p>
<p><code>nspowner</code>：名空间的所有者，引用<code>pg_authid.oid</code>。</p>
<p><code>nspacl</code>：访问权限。</p>
<hr>
<h4 id="pg_attribute">
  <code>pg_attribute</code>
  <a class="anchor" href="#pg_attribute">#</a>
</h4>
<blockquote>
<p>用于存储表的属性信息。</p>
<p>数据库里每个表的每个字段都在 pg_attribute 里有一行。还有用于索引，以及所有在 pg_class 里有记录的对象。</p>
</blockquote>
<p>字段描述：</p>
<p>attrelid：字段所属的表oid。</p>
<p>attname：表字段名。</p>
<p>atttypid：字段数据类型oid。</p>
<p>attnum：字段数目。普通字段是从 1 开始计数的。</p>
<hr>
<h4 id="pg_inherits">
  <code>pg_inherits</code>
  <a class="anchor" href="#pg_inherits">#</a>
</h4>
<blockquote>
<p>用于存储继承表的继承关系信息</p>
</blockquote>
<p>字段描述：</p>
<p><code>inhrelid</code>：子表的OID</p>
<p><code>inhparent</code>：父表的OID</p>
<p><code>inhseqno</code>：如果一个子表存在多个直系父表(多重继承)，这个数字表明此继承字段的排列顺序。计数从1开始 。</p>
<hr>
<h4 id="pg_tables">
  <code>pg_tables</code>
  <a class="anchor" href="#pg_tables">#</a>
</h4>
<blockquote>
<p>用于存储系统表的信息。</p>
</blockquote>
<p>字段描述：</p>
<p><code>schemaname</code>：模式名称。</p>
<p><code>tablename</code>：表名称。</p>
<p><code>tableowner</code>：表拥有者。</p>
<p><code>tablespace</code>：表空间名称。</p>
<hr>
<h4 id="pg_type">
  <code>pg_type</code>
  <a class="anchor" href="#pg_type">#</a>
</h4>
<blockquote>
<p>存储有关数据类型的信息。</p>
</blockquote>
<p>字段描述：</p>
<p><code>typname</code>：数据类型名</p>
<p><code>typtype</code>：b = 基础类型，c = 复合类型，d = 域类型，E = 枚举类型，p = 伪类型。</p>
<hr>
<h2 id="系统视图">
  系统视图
  <a class="anchor" href="#%e7%b3%bb%e7%bb%9f%e8%a7%86%e5%9b%be">#</a>
</h2>
<hr>
<h2 id="系统函数">
  系统函数
  <a class="anchor" href="#%e7%b3%bb%e7%bb%9f%e5%87%bd%e6%95%b0">#</a>
</h2>
<hr>
<h1 id="体系架构">
  体系架构
  <a class="anchor" href="#%e4%bd%93%e7%b3%bb%e6%9e%b6%e6%9e%84">#</a>
</h1>
<hr>
<p>PostgreSQL是一个典型的C/S模型，PostgreSQL的体系结构由实例（Instance）和存储结构（On-Disk）组成，实例（Instance）由进程（Process）和内存结构（In-Mem）组成，进程（Process）由PostMaster、SP（Session Process）和BP（Background Process）组成，内存结构（In-Mem）由SGA（System Global Area）和PGA（Program Global Area）组成。</p>
<hr>
<h2 id="存储结构">
  存储结构
  <a class="anchor" href="#%e5%ad%98%e5%82%a8%e7%bb%93%e6%9e%84">#</a>
</h2>
<hr>
<p>PostgreSQL的数据存储结构分为：逻辑存储结构和物理存储结构。其中，逻辑存储结构是PostgreSQL内部的组织和管理数据的方式，物理存储结构是操作系统中组织和管理数据的方式。</p>
<hr>
<h3 id="逻辑存储结构">
  逻辑存储结构
  <a class="anchor" href="#%e9%80%bb%e8%be%91%e5%ad%98%e5%82%a8%e7%bb%93%e6%9e%84">#</a>
</h3>
<p>所有数据库对象都有各自的oid(object identifiers)，oid是一个无符号的四字节整数，相关对象的oid都存放在相关的<code>System Catalog</code>表中，比如数据库的oid和表的oid分别存放在<code>pg_database</code>和<code>pg_class</code>表中。</p>
<blockquote>
<p>在PostgreSQL数据库终端中，使用<code>\dS+</code>命令可以看到所有的<code>System Catalog</code>。</p>
</blockquote>
<hr>
<h4 id="数据库实例database-cluster">
  数据库实例（Database Cluster）
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e5%ae%9e%e4%be%8bdatabase-cluster">#</a>
</h4>
<p>数据库实例也称为数据库集簇。它是指有单个PostgreSQL服务器实例管理的数据库集合，组成数据库集群的这些数据库使用相同的全局配置文件和监听端口、共用进程和内存结构。一个数据库实例可以包括：多个Database、多个User、以及Database中的所有对象。</p>
<hr>
<h4 id="数据库database">
  数据库（Database）
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%ba%93database">#</a>
</h4>
<p>在PostgreSQL中，数据库本身也是数据库对象，并且在逻辑上彼此分离，除数据库之外的其他数据库对象（例如：表、索引等等）都属于他们各自的数据库。</p>
<hr>
<h4 id="表空间tablespace">
  表空间（Tablespace）
  <a class="anchor" href="#%e8%a1%a8%e7%a9%ba%e9%97%b4tablespace">#</a>
</h4>
<p>数据库在逻辑上分成多个存储单元，称作表空间。表空间用作把逻辑上相关的结构放在一起。数据库逻辑上是由一个或多个表空间组成。初始化的时候，会自动创建<code>pg_default</code>和<code>pg_global</code>两个表空间。其中<code>pg_default</code>的表空间物理文件存储在数据目录中的<code>base</code>目录中，<code>pg_global</code>用于存放系统表。表空间实际上是为表指定一个存储目录。</p>
<blockquote>
<p>在PostgreSQL数据库终端中，可以使用<code>\db</code>命令可以查看到表空间。</p>
<p>创建表空间</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLESPACE</span> <span style="color:#960050;background-color:#1e0010">表空间名称</span> LOACTION <span style="color:#e6db74">&#39;目录路径&#39;</span>;
</code></pre></div><p>在表空间上创建表</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名称</span>(id int <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>) <span style="color:#66d9ef">TABLESPACE</span> <span style="color:#960050;background-color:#1e0010">表空间名称</span>;
</code></pre></div></blockquote>
<hr>
<h4 id="模式schema">
  模式（Schema）
  <a class="anchor" href="#%e6%a8%a1%e5%bc%8fschema">#</a>
</h4>
<p>当创建一个数据库时，会为其创建一个名为<code>public</code>的默认Schema。Schema是数据库中的命名空间，数据库中创建的所有对象都是在Schema中创建，一个用户可以从同一个客户端连接中访问不同的Schema。而不同的Schema中可以有多个同名的Table、Index、View、Sequence、Function等等数据库对象。</p>
<blockquote>
<p>在PostgreSQL数据库终端中，可以使用<code>\dn</code>查看当前数据库的Schema。</p>
</blockquote>
<hr>
<h4 id="段segment">
  段（Segment）
  <a class="anchor" href="#%e6%ae%b5segment">#</a>
</h4>
<p>一个段（Segment）是分配给一个逻辑结构（一个表、一个索引或其他对象）的一组区（Extent），是数据库对象使用空间的集合；段（Segment）可以有表段、索引段、回滚段、临时段和高速缓存段等。</p>
<p>每个表和索引都存储在单独的数据文件中，以表或索引的文件节点（<code>filenode</code>）编号命名，如果表或索引超过1GB就会被分割成为多段，第一个段以文件节点（<code>filenode</code>）编号命名，第二个及以后的段以<code>filenode1</code>，<code>filenode2</code>形式命名。</p>
<hr>
<h4 id="区extent">
  区（Extent）
  <a class="anchor" href="#%e5%8c%baextent">#</a>
</h4>
<p>区（Extent）是数据库存储空间分配的一个逻辑单位，它由连续的数据块（Block）所组成。一个段（Segment）是由一个或多个盘区组成。当一个段（Segment）中的所有空间使用完毕，PostgreSQL会为该段（Segment）分配一个新的范围。</p>
<hr>
<h4 id="块block">
  块（Block）
  <a class="anchor" href="#%e5%9d%97block">#</a>
</h4>
<p>在PostgreSQL中，将保存在磁盘中的块（Block）称为数据页（Page），而在内存中则称为Buffer。数据的读写是以Page为最小单位，每个Page默认的大小是8K。数据页（Page）是PostgreSQL管理数据文件中存储空间的单位，是数据库引擎使用的最小I/O单位，是最小的逻辑部件。</p>
<p>在编译PostgreSQL时指定<code>BLCKSZ</code>大小将决定Page的大小。每个表文件由多个<code>BLCKSZ</code>字节大小的Page组成。在分析型数据库中，适当增加<code>BLCKSZ</code>大小可以小幅度提升数据库的性能。</p>
<hr>
<h4 id="数据库对象database-object">
  数据库对象（Database Object）
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e5%af%b9%e8%b1%a1database-object">#</a>
</h4>
<p>数据库对象（Database Object）包含：表、视图、索引、序列、函数等。在PostgreSQL中的所有数据库对象都由各自的对象标识符（OID）进行内部的管理。而物理位置则是通过<code>relfilenode</code>进行标识。</p>
<blockquote>
<p>OID：对象标识符，在数据库系统内部使用，具有唯一性，用作系统表的主键。OID不会自动添加到用户定义的表中，但可以通过设置将OID加入到用户定义的表中，但不推荐这样使用，因为一旦用户定义的表行数超过了OID的最大限制数（4 bytes int）时，就无法再插入新行了。</p>
<p><code>relfilenode</code>：<code>relfilenode</code>默认与OID相同，但<code>relfilenode</code>标号会随着数据存储位置的改变而变化。在数据库中通过<code>SELECT oid, relname, relkind, relfilenode FROM pg_class WHERE relname ='数据表名称';</code>或者<code>select pg_relation_filenode('数据表名称')</code>获得对象的<code>relfilenode</code>标号。</p>
</blockquote>
<hr>
<h4 id="表或索引relation">
  表或索引（Relation）
  <a class="anchor" href="#%e8%a1%a8%e6%88%96%e7%b4%a2%e5%bc%95relation">#</a>
</h4>
<hr>
<h4 id="空闲空间映射表freespacemap">
  空闲空间映射表（FreeSpaceMap）
  <a class="anchor" href="#%e7%a9%ba%e9%97%b2%e7%a9%ba%e9%97%b4%e6%98%a0%e5%b0%84%e8%a1%a8freespacemap">#</a>
</h4>
<p>每一个表和索引(除了哈希索引)都有一个空闲空间映射(FSM)来保持对关系中可用空间的跟踪。随着表中不断插入和删除元组，文件块中必然会产生空闲空间（Free Space）。在插入元组时优先选择将其存放在空闲空间内是利用存储的好方法。如何管理这些空闲空间才能最大化地提高效率呢？ PG 8.4以前采用了一种全局FSM文件来记录所有表文件的空闲状况，复杂且低效。PG 8.4以后采用了新的策略，即对于每个表文件（包括系统表在内），同时创建一个名为“关系表OID_fsm” 的文件，用于记录该表的空闲空间大小。</p>
<blockquote>
<p>参考书籍：《PostgreSQL数据库内核分析》</p>
<p>参考博客：http://events.jianshu.io/p/4064dbb72414</p>
</blockquote>
<p>原理：FSM机制采用一个字节表示空闲空间的大小范围，我们将这个字节叫做FSM级别（category）。FSM级别和真实的FSM范围之间的映射关系如下表所示。
FSM级别和空闲空间范围之间的映射关系</p>
<table>
<thead>
<tr>
<th style="text-align:center">字节取值</th>
<th style="text-align:center">表示的空闲空间范围（字节）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0 ~ 31</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">32 ~ 63</td>
</tr>
<tr>
<td style="text-align:center">&hellip;&hellip;</td>
<td style="text-align:center">&hellip;&hellip;</td>
</tr>
<tr>
<td style="text-align:center">255</td>
<td style="text-align:center">8164 ~ 8192</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="可见性映射vm">
  可见性映射(VM)
  <a class="anchor" href="#%e5%8f%af%e8%a7%81%e6%80%a7%e6%98%a0%e5%b0%84vm">#</a>
</h4>
<blockquote>
<p>官网对于可见性映射的描述：https://www.postgresql.org/docs/14/storage-vm.html</p>
</blockquote>
<p>为了加快VACUUM清理的速度和降低对系统I/O的影响，PG 8.4版本之后为每个数据文件增加了一个后缀为“<code>_vm</code>”的文件。每一个表都有一个可见性映射(VM)用来跟踪哪些页面只包含已知对所有活动事务可见的元组，它也跟踪哪些页面只包含未被冻结的元组。它随着主关系数据被存储在一个独立的关系分支中，以该关系的文件节点号（<code>relfilenode</code>）加上后缀“<code>_vm</code>”进行命名。在PostgreSQL中，更新、删除行后，数据并不会马上从数据块中清理掉，而是将每个数据块中是否需要清理的数据进行标记，通过VACUUM命令扫描这个文件时，通过这些标记，可以快速找到需要清理的数据。</p>
<hr>
<h4 id="元组tuple">
  元组（Tuple）
  <a class="anchor" href="#%e5%85%83%e7%bb%84tuple">#</a>
</h4>
<hr>
<p>元组（tuple）是关系数据库中的基本概念，关系是一张表，表中的每行（即数据库中的每条记录）就是一个元组，每列就是一个属性。 在二维表里，元组也称为行。</p>
<hr>
<h3 id="物理存储结构">
  物理存储结构
  <a class="anchor" href="#%e7%89%a9%e7%90%86%e5%ad%98%e5%82%a8%e7%bb%93%e6%9e%84">#</a>
</h3>
<hr>
<p>PostgreSQL的物理存储结构主要是指硬盘上存储的文件，包括：数据文件、日志文件、参数文件、控制文件、redo日志（WAL）等。</p>
<p>在执行<code>initdb</code>命令的时候，PostgreSQL会初始化一个数据目录，通常会在操作系统中配置<code>$PGDATA</code>环境变量来表示数据目录，初始化完成后，会在这个数据目录中生成一些相关的子目录和文件。在PostgreSQL中，表空间（Tablespace）的概念不同于其他关系型数据库，在这里，一个表空间（Tablespace）会对应一个目录。</p>
<hr>
<p><code>$PGDATA</code>数据目录中的目录或文件介绍</p>
<table>
<thead>
<tr>
<th style="text-align:center">目录或文件名称</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">base</td>
<td style="text-align:center">该目录包含数据库用户所创建的各个数据库，同时也包括用户<code>postgres</code>、<code>template0</code>和<code>template1</code>的表空间<code>pg_default</code></td>
</tr>
<tr>
<td style="text-align:center">global</td>
<td style="text-align:center">该目录包含集群范围的各个表和相关视图</td>
</tr>
<tr>
<td style="text-align:center">pg_commit_ts</td>
<td style="text-align:center">该目录包含已提交事务的时间</td>
</tr>
<tr>
<td style="text-align:center">pg_dynshmem</td>
<td style="text-align:center">该目录包含动态共享内存子系统使用的文件</td>
</tr>
<tr>
<td style="text-align:center">pg_hba.conf</td>
<td style="text-align:center">该文件用于客户端认证控制（黑白名单的设置）</td>
</tr>
<tr>
<td style="text-align:center">pg_ident.conf</td>
<td style="text-align:center">该文件用来配置操作系统用户映射成为数据库用户</td>
</tr>
<tr>
<td style="text-align:center">pg_logical</td>
<td style="text-align:center">该目录包含逻辑解码状态数据</td>
</tr>
<tr>
<td style="text-align:center">pg_multixact</td>
<td style="text-align:center">该目录包含多事务状态数据（等待锁定的并发事务）</td>
</tr>
<tr>
<td style="text-align:center">pg_notify</td>
<td style="text-align:center">该目录包含LISTEN/NOTIFY状态数据</td>
</tr>
<tr>
<td style="text-align:center">pg_replslot</td>
<td style="text-align:center">该目录包含存储的复制槽/位数据</td>
</tr>
<tr>
<td style="text-align:center">pg_serial</td>
<td style="text-align:center">该目录包含已经提交的序列化事务的有关信息</td>
</tr>
<tr>
<td style="text-align:center">pg_snapshots</td>
<td style="text-align:center">该目录包含导出的快照</td>
</tr>
<tr>
<td style="text-align:center">pg_stat</td>
<td style="text-align:center">该目录包含统计子系统的永久文件</td>
</tr>
<tr>
<td style="text-align:center">pg_stat_tmp</td>
<td style="text-align:center">该目录包含统计子系统的临时文件</td>
</tr>
<tr>
<td style="text-align:center">pg_subtrans</td>
<td style="text-align:center">该目录包含子事务状态数据</td>
</tr>
<tr>
<td style="text-align:center">pg_tblspc</td>
<td style="text-align:center">该目录包含表空间的符号连接</td>
</tr>
<tr>
<td style="text-align:center">pg_twophase</td>
<td style="text-align:center">该目录包含预备事务的状态文件</td>
</tr>
<tr>
<td style="text-align:center">PG_VERSION</td>
<td style="text-align:center">该文件用于记录版本信息</td>
</tr>
<tr>
<td style="text-align:center">pg_wal</td>
<td style="text-align:center">该目录用于保存预写日志</td>
</tr>
<tr>
<td style="text-align:center">pg_xact</td>
<td style="text-align:center">该目录用于记录事务提交状态</td>
</tr>
<tr>
<td style="text-align:center">postgresql.auto.conf</td>
<td style="text-align:center">只保存<code>alter system</code>命令修改的参数</td>
</tr>
<tr>
<td style="text-align:center">postgresql.conf</td>
<td style="text-align:center">PostgreSQL的主配置文件，相当于MySQL的<code>my.cnf</code></td>
</tr>
<tr>
<td style="text-align:center">postmaster.opts</td>
<td style="text-align:center">记录服务器最后一次启动时使用的命令参数</td>
</tr>
<tr>
<td style="text-align:center">postmaster.pid</td>
<td style="text-align:center">主进程文件</td>
</tr>
</tbody>
</table>
<blockquote>
<p>在数据库中通过<code>show data_directory</code>命令可以查询<code>$PGDATA</code>的路径</p>
</blockquote>
<hr>
<h4 id="数据文件">
  数据文件
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e6%96%87%e4%bb%b6">#</a>
</h4>
<p>顾名思义，数据文件用于存储数据，也称为表文件。文件名以OID命名，对于超出1G的表数据文件，PostgreSQL会自动将其拆分为多个文件来存储，而拆分的文件名将由<code>pg_class</code>表中的<code>relfilenode</code>字段来决定。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql"><span style="color:#66d9ef">SELECT</span> oid, relname, relkind, relfilenode <span style="color:#66d9ef">FROM</span> pg_class <span style="color:#66d9ef">WHERE</span> relname <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;testtable1&#39;</span>;
</code></pre></div><hr>
<h4 id="日志文件">
  日志文件
  <a class="anchor" href="#%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6">#</a>
</h4>
<p>PostgreSQL日志文件的类型分为：运行日志（pg_log）、重做日志（pg_xlog）、事务日志（pg_xact）和服务器日志。</p>
<ul>
<li>
<p><strong>运行日志（pg_log）</strong></p>
<p>运行日志（pg_log）默认没有开启，开启后会自动生成。查看<code>postgresql.conf</code>文件的配置可以看到相关的参数设置。这个日志一般是记录服务器与数据库的状态，比如各种<code>Error</code>信息，定位慢查询SQL，数据库的启动关闭信息，发生<code>checkpoint</code>过于频繁等的告警信息，诸如此类。该日志有<code>.csv</code>格式和<code>.log</code>。建议使用<code>.csv</code>格式，因为它一般会按大小和时间自动切割。运行日志（pg_log）是可以被清理删除、压缩打包或者转移的，同时并不影响数据库的正常运行。当遇到数据库无法启动或者更改参数没有生效时，第一个想到的就是查看这个日志。</p>
</li>
<li>
<p><strong>重做日志（pg_xlog）</strong></p>
<p>重做日志（pg_xlog） 是记录PostgreSQL的WAL信息，默认存储在<code>$PGDATA/pg_wal/</code>目录下，是一些事务日志信息(Transaction Log)。默认单个大小是16M，源码安装的时候可以更改其大小（通过<code>./configure --with-wal-segsize=target_value</code> 参数进行设置），这些日志会在定时回滚恢复(PITR)、流复制(Replication Stream)以及归档时被用到，这些日志文件非常重要，记录着数据库发生的各种事务信息，不得随意删除或者移动，不然数据库会有无法恢复的风险。</p>
</li>
<li>
<p><strong>事务日志（pg_xact）</strong></p>
<p>事务日志（pg_xact）是事务的提交日志，记录了事务的元数据。默认开启，内容一般不能直接读取。默认存储在<code>$PGDATA/pg_xact/</code>目录下。</p>
</li>
<li>
<p><strong>服务器日志</strong></p>
<p>服务器日志记录了数据库的重要信息。如果用<code>pg_ctl</code>命令启动数据库的时候，没有指定<code>-l</code>参数来指定服务器日志，错误信息可能会直接输出到cmd前台而不被保存。</p>
</li>
</ul>
<hr>
<h4 id="参数文件">
  参数文件
  <a class="anchor" href="#%e5%8f%82%e6%95%b0%e6%96%87%e4%bb%b6">#</a>
</h4>
<p>PostgreSQL数据库中主要的参数文件是<code>postgresql.conf</code>、<code>pg_hba.conf</code>、<code>postgresql_auto.conf</code>和<code>pg_ident.conf</code>。</p>
<ul>
<li>
<p><code>postgresql.conf</code></p>
<p>PostgreSQL的主参数文件，有很详细的说明和注释，和Oracle的<code>pfile</code>，MySQL的<code>my.cnf</code>类似。默认在<code>$PGDATA</code>下。很多参数修改后都需要重启。仔9.6版本之后支持了使用<code>alter system</code>命令来修改，修改后的参数会保存在<code>$PGDATA/postgresql.auto.conf</code>文件下，可以使用<code>reload</code>或者<code>restart</code>来使之生效。</p>
</li>
<li>
<p><code>pg_hba.conf</code></p>
<p>这是一个类似黑白名单，用于访问控制的参数配置文件。</p>
</li>
<li>
<p><code>postgresql_auto.conf</code></p>
<p>它和<code>postgresql.conf</code>的格式相同，但不允许手动编辑，只允许在数据库中通过<code>ALTER SYSTEM</code>命令设置参数，换句话说，<code>postgresql_auto.conf</code>只保存<code>alter system</code>命令修改的参数。在读取<code>postgresql.conf</code>文件时自动读取<code>postgresql_auto.conf</code>，并且<code>postgresql_auto.conf</code>的设置会覆盖掉<code>postgresql.conf</code>中的设置。</p>
</li>
<li>
<p><code>pg_ident.conf</code></p>
<p>这是一个用户映射配置文件，用来配置哪些操作系统用户可以映射为数据库用户。结合<code>pg_hba.conf</code>配置文件中的<code>method</code>为<code>ident</code>可以用特定的操作系统用户和指定的数据库用户登录数据库。</p>
</li>
</ul>
<hr>
<h4 id="控制文件">
  控制文件
  <a class="anchor" href="#%e6%8e%a7%e5%88%b6%e6%96%87%e4%bb%b6">#</a>
</h4>
<p>控制文件（ControlFile）记录了数据库的运行信息，比如数据库ID，是否运行，WAL的位置，CheckPoint的位置等。控制文件（ControlFile）是很重要的文件。
控制文件默认存储在<code>$PGDATA/global/pg_control</code>目录下，在操作系统中使用<code>pg_controldata $PGDATA</code>命令可以查看控制文件的内容。</p>
<hr>
<h4 id="redo日志wal">
  redo日志（WAL）
  <a class="anchor" href="#redo%e6%97%a5%e5%bf%97wal">#</a>
</h4>
<p>默认存储在<code>$PGDATA/pg_wal</code>目录下，目录中文件名称为16进制由24个字符组成的文件名，每8个字符一组，每组的意义如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ae81ff">00000001</span>  <span style="color:#ae81ff">00000000</span>  <span style="color:#ae81ff">00000001</span>
 时间线     逻辑ID    物理ID
</code></pre></div><p>在数据库中通过<code>select pg_switch_wal();</code>命令可以手动切换WAL。</p>
<hr>
<h2 id="进程结构">
  进程结构
  <a class="anchor" href="#%e8%bf%9b%e7%a8%8b%e7%bb%93%e6%9e%84">#</a>
</h2>
<hr>
<p>在Linux操作系统中使用<code>ps -ef | grep postgres</code>命令可以查询到所有PostgreSQL的进程。</p>
<hr>
<h3 id="postmaster进程">
  Postmaster进程
  <a class="anchor" href="#postmaster%e8%bf%9b%e7%a8%8b">#</a>
</h3>
<p>主进程Postmaster是整个数据库实例的总控制进程，负责启动和关闭数据库实例。用户可以运行<code>/usr/local/postgresql/bin/postgres</code>加上合适的参数来启动数据库和Postmaster进程，实际上，<code>postgres</code>是一个指向<code>postmaster</code>的软链接。更多时候，我们使用<code>pg_ctl</code>命令启动数据库，<code>pg_ctl</code>命令也是通过运行<code>postgres</code>来启动数据库，它只是做了一些包装，让我们更容易启动数据库，所以，主进程Postmaster实际是第一个<code>postgres</code>进程，此进程会fork一些与数据库实例相关的辅助子进程，并管理他们。</p>
<p>当用户与PostgreSQL数据库建立连接时，实际上是先与Postmaster主进程建立连接。此时，客户端程序会发出身份证验证的消息给Postmaster进程，Postmaster主进程根据消息中的信息进行客户端身份验证。如果验证通过，它会fork一个名为<code>postgres</code>的子进程（有些地方也称为：Backend Process）为这个连接服务，fork出来的<code>postgres</code>子进程被称为服务进程，查询<code>pg_stat_activity</code>表可以看到这些服务进程的PID。</p>
<hr>
<h3 id="syslogger进程">
  SysLogger进程
  <a class="anchor" href="#syslogger%e8%bf%9b%e7%a8%8b">#</a>
</h3>
<p>在<code>postgresql.conf</code>主配置文件里启用运行日志（pg_log）后，会产生SysLogger进程。SysLogger进程会在日志文件达到指定的大小时关闭当前日志文件，并产生新的日志文件。相关配置参数如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">配置参数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">log_destination</td>
<td style="text-align:center">配置日志输出的目标，根据不同平台设置不同的值，Linux下默认为stderr</td>
</tr>
<tr>
<td style="text-align:center">logging_collector</td>
<td style="text-align:center">是否开启日志收集器，当设置为<code>on</code>时，启动日志功能，否则，系统将不产生系统日志辅助进程</td>
</tr>
<tr>
<td style="text-align:center">log_directory</td>
<td style="text-align:center">配置日志输出的文件目录</td>
</tr>
<tr>
<td style="text-align:center">log_filename</td>
<td style="text-align:center">配置日志文件名称的命名规则</td>
</tr>
<tr>
<td style="text-align:center">log_rotation_size</td>
<td style="text-align:center">配置日志文件大小，当前日志文件达到这个大小时会被关闭，然后创建一个新的日志文件</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="bgwriter进程">
  BgWriter进程
  <a class="anchor" href="#bgwriter%e8%bf%9b%e7%a8%8b">#</a>
</h3>
<p>BgWriter（后台写）进程是PostgreSQL中在后台将脏页写到磁盘的辅助进程，引入该进程主要为了达到两个目的：</p>
<ul>
<li>
<p>当数据库在进行查询处理时，若发现要读取的数据不在缓冲区中，要先从磁盘中读取数据所在的数据页（Page）（缓冲区由一个数据页(块)的空间和标题组成），此时，如果缓冲区已满，则需要先选择部分缓冲区中的数据页（Page）将其替换出去。如果被替换的数据页（Page）没有被修改过，那么可以直接丢弃；但如果要被替换的数据页（Page）已被修改，则必需先将这些数据页（Page）写到磁盘中后才能替换，这样一来，数据库的查询处理就会被阻塞。通过使用BgWriter定期将缓冲区中的部分脏页写到磁盘上，为缓冲区腾出空间，这样就可以降低查询处理被阻塞的可能性。</p>
<blockquote>
<p>脏页是linux内核中的概念，因为硬盘的读写速度远赶不上内存的速度，系统就把读写比较频繁的数据事先放到内存中，以提高读写速度，这就叫高速缓存，linux是以页作为高速缓存的单位，当进程修改了高速缓存里的数据时，该页就被内核标记为脏页，内核将会在合适的时间把脏页的数据写到磁盘中去，以保持高速缓存中的数据和磁盘中的数据是一致的。</p>
</blockquote>
</li>
<li>
<p>PostgreSQL在定期作检查点时，需要把所有脏页写到磁盘，通过BgWriter预先将一些脏页写出到磁盘，可以减少设置检查点时要进行的I/O操作，使系统的I/O负载趋向平稳。通过BgWriter对共享缓冲区写操作的统一管理，避免了其他服务进程在需要读取新的数据页（Page）到共享缓冲区时，需将之前修改过的页面写到磁盘的操作。</p>
</li>
</ul>
<hr>
<h3 id="walwriter进程">
  WALWriter进程
  <a class="anchor" href="#walwriter%e8%bf%9b%e7%a8%8b">#</a>
</h3>
<p>WALWriter（预写日志写）进程用于保存WAL预写日志。预写式日志WAL（Write Ahead Log，也称为Xlog）的中心思想是：对数据文件的修改必须只能发生在这些修改已经记录到日志之后，也就是先写日志后写数据。如果遵循这个过程，那么就不需要在每次事务提交的时候都把数据页（Page）写到磁盘，这一点与Oracle数据库是完全一致的。与WalWriter进程有关的配置在<code>postgresql.conf</code>主配置文件中的<code>\# WRITE AHEAD LOG</code>下，默认为开启状态。</p>
<blockquote>
<p>先写日志后写数据是为保证数据库的可恢复性，日志文件能够用来进行事务故障恢复和系统故障恢复，并能够协助后备副本进行介质故障恢复。当数据库文件毁坏后，通过数据库备份可以将数据库恢复到转储结束时刻的正确状态，再利用建立的日志文件，可以把已完成的事务进行重做（redo）处理，而对于故障发生时尚未完成的事务则进行撤消处理，这样不用运行应用程序就可把数据库恢复到故障前某一时刻的正确状态。”</p>
</blockquote>
<hr>
<h3 id="pgarch进程">
  PgArch进程
  <a class="anchor" href="#pgarch%e8%bf%9b%e7%a8%8b">#</a>
</h3>
<p>PgArch（归档）进程。从PostgreSQL 8.x开始，有了PITR（Point-In-Time-Recovery）技术，该技术支持将数据库恢复到其运行历史中任意一个有记录的时间点；PITR的另一个重要的基础就是对WAL文件的归档功能。PgArch归档进程的目标就是对WAL日志在磁盘上的存储形式进行归档备份。但在默认情况下，PostgreSQL是非归档模式，因此看不到PgArch进程。与PgArch进程有关的配置在<code>postgresql.conf</code>主配置文件中的<code># - Archiving -</code>下，需要手动开启。</p>
<hr>
<h3 id="autovacuum进程">
  AutoVacuum进程
  <a class="anchor" href="#autovacuum%e8%bf%9b%e7%a8%8b">#</a>
</h3>
<p>AutoVacuum（自动清理）进程。在PostgreSQL数据库中，对数据进行<code>UPDATE</code>或者<code>DELETE</code>操作后，数据库不会立即删除旧版本的数据，而是标记为删除状态。这是因为PG数据库具有多版本的机制，如果这些旧版本的数据正在被另外的事务打开，那么暂时保留他们是很有必要的。当事务提交后，旧版本的数据已经没有价值了，数据库需要清理垃圾数据腾出空间，而清理工作就是AutoVacuum进程进行的。与AutoVacuum进程有关的配置在<code>postgresql.conf</code>主配置文件中的<code># AUTOVACUUM</code>下，默认为开启状态。</p>
<hr>
<h3 id="pgstat进程">
  PgStat进程
  <a class="anchor" href="#pgstat%e8%bf%9b%e7%a8%8b">#</a>
</h3>
<p>PgStat（统计信息收集）进程是PostgreSQL数据库的信息统计收集器，用来收集数据库运行期间的统计信息，如数据表的增、删、改次数，数据块（数据页）的个数，索引的变化等。收集统计信息主要是为了让优化器能做出正确的判断，选择最佳的执行计划。与PgStat进程有关的配置在<code>postgresql.conf</code>主配置文件中的<code># RUNTIME STATISTICS</code>下，默认为开启状态。</p>
<hr>
<h3 id="checkpoint进程">
  CheckPoint进程
  <a class="anchor" href="#checkpoint%e8%bf%9b%e7%a8%8b">#</a>
</h3>
<p>CheckPoint（检查点）进程是数据库系统设置的事务序列点，设置检查点是为了保证检查点前的日志信息写入到磁盘中。与CheckPoint进程有关的配置在<code>postgresql.conf</code>主配置文件中的<code># - Checkpoints -</code>下，默认为开启状态。</p>
<hr>
<h2 id="内存结构">
  内存结构
  <a class="anchor" href="#%e5%86%85%e5%ad%98%e7%bb%93%e6%9e%84">#</a>
</h2>
<hr>
<p>PostgreSQL的内存结构分为本地内存和共享内存。</p>
<hr>
<h3 id="本地内存">
  本地内存
  <a class="anchor" href="#%e6%9c%ac%e5%9c%b0%e5%86%85%e5%ad%98">#</a>
</h3>
<p>本地内存是由Postmaster主进程fork出的每个<code>postgres</code>的子进程（有些地方也称为：Backend Process）自己所使用的内存区域。</p>
<p>所有本地内存的参数都在<code>$PGDATA/postgresql.conf</code>主配置文件中进行设置。</p>
<table>
<thead>
<tr>
<th style="text-align:center">本地内存的参数类型</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>work_mem</code></td>
<td style="text-align:center">使用<code>work_mem</code>区域用于对元组的排序，例如：<code>order by</code>、<code>distinct</code>等命令的操作。也用于表之间的<code>join</code>操作，例如：<code>merge-join</code>、<code>hash-join</code>等命令的操作，都是由<code>work_mem</code>参数控制内存大小的，默认是4MB。推荐值：<code>（输入内存数量-shared_buffers）/（连接数*3）*1024KB</code>，注意不要全局生效。</td>
</tr>
<tr>
<td style="text-align:center"><code>mantenance_work_mem</code></td>
<td style="text-align:center">用于一些数据库维护操作时可使用内存空间的大小。例如：<code>vacuum</code>、<code>reindex</code>、<code>alter table add foreign key</code>等命令的操作，都是由<code>mantenance_work_mem</code>参数控制内存大小的，默认是64MB。由于数据库会话一次只能执行其中的一个操作，并且PostgreSQL不会同时运行许多操作，因此可以将<code>mantenance_work_mem</code>参数的值设置为明显大于<code>work_mem</code>的值。设置建议：<code>内存容量*10%</code>，最大不超过1GB。</td>
</tr>
<tr>
<td style="text-align:center"><code>temp_buffers</code></td>
<td style="text-align:center">用于存放临时表。该参数用于设置每个数据库会话使用的临时缓冲区的最大值。会话本地缓冲区仅用于访问临时表。可以在单个会话中更改此参数的设置，但只能在会话中首次使用临时表之前更改。PostgreSQL利用这个内存区域来保存每个会话的临时表，当会话关闭时，这些临时表将被清除，<code>temp_buffers</code>的默认值是8MB</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="共享内存">
  共享内存
  <a class="anchor" href="#%e5%85%b1%e4%ba%ab%e5%86%85%e5%ad%98">#</a>
</h3>
<p>所有进程共同使用的的内存区域。</p>
<p>共享内存除了clog，其他参数都在<code>$PGDATA/postgresql.conf</code>主配置文件中进行设置。</p>
<table>
<thead>
<tr>
<th style="text-align:center">共享内存的参数类型</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>shared_buffers</code></td>
<td style="text-align:center">表示数据缓冲区中数据块的个数，每个数据块的大小是8KB。PostgreSQL将表和索引中的页面从持久存储（硬盘）加载到内存的共享缓冲池中，然后直接对他们进行操作，共享缓冲池的大小由参数<code>shared_buffers</code>参数控制，默认是：128MB。推荐值：1/4主机物理内存。</td>
</tr>
<tr>
<td style="text-align:center"><code>wal_buffers</code></td>
<td style="text-align:center">用存放还未写入到磁盘的WAL数据，降低磁盘I/O。默认值<code>-1</code>表示该参数设置为<code>shared_buffers</code>的<code>1/32</code>（大约3%）。</td>
</tr>
<tr>
<td style="text-align:center"><code>clog</code></td>
<td style="text-align:center"><code>clog</code>(全称Commit Log，
  <a href="https://github.com/postgres/postgres/blob/b35006ecccf505d05fd77ce0c820943996ad7ee9/src/backend/access/transam/clog.c">PostgreSQL transaction-commit-log manager</a>，主要在<code>clog.c</code>中实现)里面记录了事务的执行状态，每次事务提交和回滚的时候，都需要更新该状态（调用CommitTransactionCommand(void)），PostgreSQL服务器访问该文件确定事务的状态，保存在<code>$PGDATA/pg_xact</code>目录中，每个文件大小为256KB，每个事务2位（bit），故1个文件可以包含131072个事务。事务有以下四种状态：<code>in_progress</code>、<code>commited</code>、<code>aborted</code>、<code>sub-commited</code>。</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="总结">
  总结
  <a class="anchor" href="#%e6%80%bb%e7%bb%93">#</a>
</h2>
<hr>
<ol>
<li>
<p>PostgreSQL是一种客户端/服务器的进程架构模型，主要包括内存管理、服务进程、配置文件、磁盘存储管理等几个部分。</p>
</li>
<li>
<p>PostgreSQL中服务对数据的操作主要是通过内存中的缓冲区与磁盘上的数据文件进行交互，内存中的缓冲区分为本地（私有）和共享两种类型。</p>
</li>
<li>
<p>PostgreSQL中配置文件主要负责约束PostgreSQL服务进程的工作方式，同时负责数据库安全访问等功能。</p>
</li>
<li>
<p>PostgreSQL数据库的数据表是以表文件的方式存储在指定的文件目录下，大小超过1G时会生成新的表文件。在相同目录下，还存有空闲空间映射（FSM）文件和可见性映射（VM）文件。</p>
</li>
<li>
<p>PostgreSQL数据库常用的操作命令</p>
<ul>
<li>
<p>查看Cluster中有哪些数据库</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql">postgres<span style="color:#f92672">=#</span> <span style="color:#960050;background-color:#1e0010">\</span>d
</code></pre></div></li>
<li>
<p>查看数据表结构</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql">postgres<span style="color:#f92672">=#</span> <span style="color:#960050;background-color:#1e0010">\</span>d <span style="color:#960050;background-color:#1e0010">表名称</span>
</code></pre></div></li>
<li>
<p>查看数据表存储的相对路径</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql">postgres<span style="color:#f92672">=#</span> <span style="color:#66d9ef">select</span> pg_relation_filepath(<span style="color:#e6db74">&#39;表名称&#39;</span>);
</code></pre></div></li>
<li>
<p>查看base目录的存储路径</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgresql" data-lang="postgresql">postgres<span style="color:#f92672">=#</span> <span style="color:#66d9ef">show</span> data_directory;
</code></pre></div><blockquote>
<p>在PostgreSQL中可以通过<code>\! [COMMAND]</code>的方式运行shell命令。</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<hr>
<h1 id="postgresql优化">
  PostgreSQL优化
  <a class="anchor" href="#postgresql%e4%bc%98%e5%8c%96">#</a>
</h1>
<hr>
<h2 id="postgresqlconf">
  postgresql.conf
  <a class="anchor" href="#postgresqlconf">#</a>
</h2>
<p><code>random_page_cost = 2.5</code>  # 规划器对一次非顺序获取磁盘页面的代价估计。默认值是：<code>4.0</code>。高端存储或SSD可适当调小该参数。</p>
<p><code>autovacuum_max_worker = 10</code>  # 指定能同时运行autovacuum进程的最大数量，可以适当调大，避免vacuum不及时导致表膨胀。</p>
<p><code>checkpoint_completion_target = 0.7</code>  # 适当调大该参数来降低检查点的I/O负载，默认值是：<code>0.5</code>。</p>
<p><code>archive_timeout = 1800</code>  # 强制服务器周期性的切换到新的WAL段文件。</p>
<p><code>archive_command = 'test ! -f /paic/dba/pgbackup/${PGNAME}/archlog/%f &amp;&amp; pxz -2 &lt; %p &gt; /paic/dba/pgbackup/${PGNAME}/archlog/%f'</code>  # pxz压缩归档日志，64M的归档，压缩时间可以在0.5秒内，压缩比一般可以在<code>1:3</code>左右。</p>
<hr>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#安装">安装</a>
      <ul>
        <li><a href="#yum-repository">Yum Repository</a></li>
        <li><a href="#apt-repository">Apt Repository</a></li>
        <li><a href="#源码编译安装source">源码编译安装（Source）</a>
          <ul>
            <li><a href="#创建用户组和用户">创建用户组和用户</a></li>
            <li><a href="#安装依赖包">安装依赖包</a></li>
            <li><a href="#下载软件并解压">下载软件并解压</a></li>
            <li><a href="#创建目录及授权">创建目录及授权</a></li>
            <li><a href="#系统参数优化">系统参数优化</a></li>
            <li><a href="#编译安装软件">编译安装软件</a></li>
            <li><a href="#初始化数据">初始化数据</a></li>
            <li><a href="#启动postgressql">启动PostgresSQL</a></li>
            <li><a href="#连接测试postgressql">连接测试PostgresSQL</a></li>
            <li><a href="#添加开机启动启动">添加开机启动启动</a></li>
            <li><a href="#卸载">卸载</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#基础管理">基础管理</a>
      <ul>
        <li><a href="#配置文件">配置文件</a></li>
        <li><a href="#启动关闭和重启服务">启动、关闭和重启服务</a>
          <ul>
            <li><a href="#启动服务">启动服务</a></li>
            <li><a href="#关闭服务">关闭服务</a></li>
            <li><a href="#重启服务">重启服务</a></li>
            <li><a href="#重新加载配置">重新加载配置</a></li>
          </ul>
        </li>
        <li><a href="#用户管理">用户管理</a>
          <ul>
            <li><a href="#创建用户">创建用户</a></li>
            <li><a href="#删除用户">删除用户</a></li>
            <li><a href="#修改用户">修改用户</a></li>
            <li><a href="#查看用户">查看用户</a></li>
          </ul>
        </li>
        <li><a href="#权限管理">权限管理</a>
          <ul>
            <li><a href="#权限级别">权限级别</a></li>
            <li><a href="#权限定义">权限定义</a></li>
          </ul>
        </li>
        <li><a href="#查看配置参数">查看配置参数</a></li>
        <li><a href="#修改配置参数">修改配置参数</a>
          <ul>
            <li><a href="#修改全局配置参数">修改全局配置参数</a></li>
            <li><a href="#修改非全配置参数">修改非全配置参数</a></li>
            <li><a href="#配置参数生效说明">配置参数生效说明</a></li>
            <li><a href="#修改日志相关配置">修改日志相关配置</a></li>
          </ul>
        </li>
        <li><a href="#psql的基本用法">psql的基本用法</a></li>
        <li><a href="#pgadmin的基本用法">pgAdmin的基本用法</a>
          <ul>
            <li><a href="#pgadmin的主要功能">pgAdmin的主要功能</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#系统表视图和函数">系统表、视图和函数</a>
      <ul>
        <li><a href="#系统表">系统表</a>
          <ul>
            <li><a href="#系统表的模式">系统表的模式</a></li>
            <li><a href="#常用的系统表">常用的系统表</a></li>
          </ul>
        </li>
        <li><a href="#系统视图">系统视图</a></li>
        <li><a href="#系统函数">系统函数</a></li>
      </ul>
    </li>
    <li><a href="#体系架构">体系架构</a>
      <ul>
        <li><a href="#存储结构">存储结构</a>
          <ul>
            <li><a href="#逻辑存储结构">逻辑存储结构</a></li>
            <li><a href="#物理存储结构">物理存储结构</a></li>
          </ul>
        </li>
        <li><a href="#进程结构">进程结构</a>
          <ul>
            <li><a href="#postmaster进程">Postmaster进程</a></li>
            <li><a href="#syslogger进程">SysLogger进程</a></li>
            <li><a href="#bgwriter进程">BgWriter进程</a></li>
            <li><a href="#walwriter进程">WALWriter进程</a></li>
            <li><a href="#pgarch进程">PgArch进程</a></li>
            <li><a href="#autovacuum进程">AutoVacuum进程</a></li>
            <li><a href="#pgstat进程">PgStat进程</a></li>
            <li><a href="#checkpoint进程">CheckPoint进程</a></li>
          </ul>
        </li>
        <li><a href="#内存结构">内存结构</a>
          <ul>
            <li><a href="#本地内存">本地内存</a></li>
            <li><a href="#共享内存">共享内存</a></li>
          </ul>
        </li>
        <li><a href="#总结">总结</a></li>
      </ul>
    </li>
    <li><a href="#postgresql优化">PostgreSQL优化</a>
      <ul>
        <li><a href="#postgresqlconf">postgresql.conf</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












